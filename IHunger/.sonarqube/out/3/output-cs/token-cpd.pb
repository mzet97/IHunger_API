ã
XD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\AddressRestaurantService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class $
AddressRestaurantService )
:* +%
IAddressRestaurantService, E
{		 
}

 
} Ñ
RD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\AddressUserService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class 
AddressUserService #
:$ %
IAddressUserService& 9
{		 
}

 
} Û¹
KD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\AuthService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class 
AuthService 
: 
BaseService *
,* +
IAuthService, 8
{ 
private 
readonly 
SignInManager &
<& '
User' +
>+ ,
_signInManager- ;
;; <
private 
readonly 
UserManager $
<$ %
User% )
>) *
_userManager+ 7
;7 8
private 
readonly 
AppSettings $
_appSettings% 1
;1 2
private 
readonly "
IProfileUserRepository /"
_profileUserRepository0 F
;F G
public 
AuthService 
( 
	INotifier 
notifier 
, 
SignInManager 
< 
User 
> 
signInManager  -
,- .
UserManager 
< 
User 
> 
userManager )
,) *
IOptions 
< 
AppSettings  
>  !
appSettings" -
,- ."
IProfileUserRepository   "!
profileUserRepository  # 8
)  8 9
:  : ;
base!! 
(!! 
notifier!! 
)!! 
{"" 	
_signInManager## 
=## 
signInManager## *
;##* +
_userManager$$ 
=$$ 
userManager$$ &
;$$& '
_appSettings%% 
=%% 
appSettings%% &
.%%& '
Value%%' ,
;%%, -"
_profileUserRepository&& "
=&&# $!
profileUserRepository&&% :
;&&: ;
}'' 	
public)) 
async)) 
Task)) 
<)) "
LoginResponseViewModel)) 0
>))0 1
Register))2 :
()): ;
User)); ?
user))@ D
,))D E
string))F L
password))M U
)))U V
{** 	
if++ 
(++ 
!++ 
Validate++ 
(++ 
new++ !
ProfileUserValidation++ 3
(++3 4
)++4 5
,++5 6
user++7 ;
.++; <
ProfileUser++< G
)++G H
)++H I
return++J P
null++Q U
;++U V
if,, 
(,, 
!,, 
Validate,, 
(,, 
new,, !
AddressUserValidation,, 3
(,,3 4
),,4 5
,,,5 6
user,,7 ;
.,,; <
ProfileUser,,< G
.,,G H
AddressUser,,H S
),,S T
),,T U
return,,V \
null,,] a
;,,a b
var.. 
resultCreateUser..  
=..! "
await..# (
_userManager..) 5
...5 6
CreateAsync..6 A
(..A B
user..B F
,..F G
password..H P
)..P Q
;..Q R
if00 
(00 
resultCreateUser00  
.00  !
	Succeeded00! *
)00* +
{11 
await22 
	AddClaims22 
(22  
user22  $
)22$ %
;22% &
await33 
_signInManager33 $
.33$ %
SignInAsync33% 0
(330 1
user331 5
,335 6
false337 <
)33< =
;33= >
return44 
await44 
GetJwt44 #
(44# $
user44$ (
.44( )
Email44) .
)44. /
;44/ 0
}55 
foreach77 
(77 
var77 
error77 
in77 !
resultCreateUser77" 2
.772 3
Errors773 9
)779 :
{88 
NotifyError99 
(99 
error99 !
.99! "
Description99" -
)99- .
;99. /
}:: 
return<< 
await<< 
GetJwt<< 
(<<  
user<<  $
.<<$ %
Email<<% *
)<<* +
;<<+ ,
}== 	
public?? 
async?? 
Task?? 
<?? "
LoginResponseViewModel?? 0
>??0 1
Login??2 7
(??7 8
string??8 >
email??? D
,??D E
string??F L
password??M U
)??U V
{@@ 	
varAA 
resultAA 
=AA 
awaitAA 
_signInManagerAA -
.AA- .
PasswordSignInAsyncAA. A
(AAA B
emailAAB G
,AAG H
passwordAAI Q
,AAQ R
falseAAS X
,AAX Y
falseAAZ _
)AA_ `
;AA` a
ifCC 
(CC 
resultCC 
.CC 
	SucceededCC  
)CC  !
{DD 
returnEE 
awaitEE 
GetJwtEE #
(EE# $
emailEE$ )
)EE) *
;EE* +
}FF 
elseGG 
ifGG 
(GG 
resultGG 
.GG 
IsLockedOutGG '
)GG' (
{HH 
NotifyErrorII 
(II 
$strII 6
)II6 7
;II7 8
returnJJ 
nullJJ 
;JJ 
}KK 
NotifyErrorMM 
(MM 
$strMM 8
)MM8 9
;MM9 :
returnNN 
nullNN 
;NN 
}OO 	
privateQQ 
asyncQQ 
TaskQQ 
<QQ 
stringQQ !
>QQ! "
CreateSecurityTokenQQ# 6
(QQ6 7
stringQQ7 =
emailQQ> C
)QQC D
{RR 	
varSS 
userSS 
=SS 
awaitSS 
GetUserSS $
(SS$ %
emailSS% *
)SS* +
;SS+ ,
ifUU 
(UU 
userUU 
==UU 
nullUU 
)UU 
{VV 
NotifyErrorWW 
(WW 
$strWW <
)WW< =
;WW= >
returnXX 
nullXX 
;XX 
}YY 
var[[ 
token[[ 
=[[ 
await[[ 
_userManager[[ *
.[[* +$
CreateSecurityTokenAsync[[+ C
([[C D
user[[D H
)[[H I
;[[I J
if]] 
(]] 
token]] 
!=]] 
null]] 
)]] 
{^^ 
return__ 
token__ 
.__ 
ToString__ %
(__% &
)__& '
;__' (
}`` 
returnbb 
nullbb 
;bb 
}cc 	
privateee 
asyncee 
Taskee 
<ee 
stringee !
>ee! "(
CreateEmailConfirmationTokenee# ?
(ee? @
stringee@ F
emaileeG L
)eeL M
{ff 	
vargg 
usergg 
=gg 
awaitgg 
GetUsergg $
(gg$ %
emailgg% *
)gg* +
;gg+ ,
ifii 
(ii 
userii 
==ii 
nullii 
)ii 
{jj 
NotifyErrorkk 
(kk 
$strkk <
)kk< =
;kk= >
returnll 
nullll 
;ll 
}mm 
varoo 
tokenoo 
=oo 
awaitoo 
_userManageroo *
.oo* +/
#GenerateEmailConfirmationTokenAsyncoo+ N
(ooN O
userooO S
)ooS T
;ooT U
ifqq 
(qq 
stringqq 
.qq 
IsNullOrWhiteSpaceqq )
(qq) *
tokenqq* /
)qq/ 0
)qq0 1
{rr 
NotifyErrorss 
(ss 
$strss 2
)ss2 3
;ss3 4
returntt 
nulltt 
;tt 
}uu 
returnww 
tokenww 
;ww 
}xx 	
privatezz 
asynczz 
Taskzz 
<zz 
stringzz !
>zz! ""
CreateEmailChangeTokenzz# 9
(zz9 :
stringzz: @
emailzzA F
,zzF G
stringzzH N
newEmailzzO W
)zzW X
{{{ 	
var|| 
user|| 
=|| 
await|| 
GetUser|| $
(||$ %
email||% *
)||* +
;||+ ,
if~~ 
(~~ 
user~~ 
==~~ 
null~~ 
)~~ 
{ 
NotifyError
€€ 
(
€€ 
$str
€€ <
)
€€< =
;
€€= >
return
 
null
 
;
 
}
‚‚ 
var
„„ 
token
„„ 
=
„„ 
await
„„ 
_userManager
„„ *
.
„„* ++
GenerateChangeEmailTokenAsync
„„+ H
(
„„H I
user
„„I M
,
„„M N
newEmail
„„O W
)
„„W X
;
„„X Y
if
†† 
(
†† 
string
†† 
.
††  
IsNullOrWhiteSpace
†† )
(
††) *
token
††* /
)
††/ 0
)
††0 1
{
‡‡ 
NotifyError
ˆˆ 
(
ˆˆ 
$str
ˆˆ 2
)
ˆˆ2 3
;
ˆˆ3 4
return
‰‰ 
null
‰‰ 
;
‰‰ 
}
ŠŠ 
return
ŒŒ 
token
ŒŒ 
;
ŒŒ 
}
 	
private
 
async
 
Task
 
<
 
bool
 
>
  
ConfirmEmail
! -
(
- .
string
. 4
email
5 :
,
: ;
string
< B
token
C H
)
H I
{
 	
var
‘‘ 
user
‘‘ 
=
‘‘ 
await
‘‘ 
GetUser
‘‘ $
(
‘‘$ %
email
‘‘% *
)
‘‘* +
;
‘‘+ ,
if
““ 
(
““ 
user
““ 
==
““ 
null
““ 
)
““ 
{
”” 
NotifyError
•• 
(
•• 
$str
•• <
)
••< =
;
••= >
return
–– 
false
–– 
;
–– 
}
—— 
var
™™ 
identityResp
™™ 
=
™™ 
await
™™ $
_userManager
™™% 1
.
™™1 2
ConfirmEmailAsync
™™2 C
(
™™C D
user
™™D H
,
™™H I
token
™™J O
)
™™O P
;
™™P Q
if
›› 
(
›› 
identityResp
›› 
.
›› 
	Succeeded
›› &
)
››& '
{
œœ 
return
 
true
 
;
 
}
 
return
   
false
   
;
   
}
¡¡ 	
private
££ 
async
££ 
Task
££ 
<
££ 
string
££ !
>
££! "&
CreatePasswordResetToken
££# ;
(
££; <
string
££< B
email
££C H
)
££H I
{
¤¤ 	
var
¥¥ 
user
¥¥ 
=
¥¥ 
await
¥¥ 
GetUser
¥¥ $
(
¥¥$ %
email
¥¥% *
)
¥¥* +
;
¥¥+ ,
if
§§ 
(
§§ 
user
§§ 
==
§§ 
null
§§ 
)
§§ 
{
¨¨ 
NotifyError
©© 
(
©© 
$str
©© <
)
©©< =
;
©©= >
return
ªª 
null
ªª 
;
ªª 
}
«« 
var
­­ 
token
­­ 
=
­­ 
await
­­ 
_userManager
­­ *
.
­­* +-
GeneratePasswordResetTokenAsync
­­+ J
(
­­J K
user
­­K O
)
­­O P
;
­­P Q
if
¯¯ 
(
¯¯ 
string
¯¯ 
.
¯¯  
IsNullOrWhiteSpace
¯¯ )
(
¯¯) *
token
¯¯* /
)
¯¯/ 0
)
¯¯0 1
{
°° 
NotifyError
±± 
(
±± 
$str
±± 2
)
±±2 3
;
±±3 4
return
²² 
null
²² 
;
²² 
}
³³ 
return
µµ 
token
µµ 
;
µµ 
}
¶¶ 	
private
¸¸ 
async
¸¸ 
Task
¸¸ 
<
¸¸ 
bool
¸¸ 
>
¸¸  
RecoverPassword
¸¸! 0
(
¸¸0 1
string
¸¸1 7
email
¸¸8 =
,
¸¸= >
string
¸¸? E
password
¸¸F N
,
¸¸N O
string
¸¸P V
token
¸¸W \
)
¸¸\ ]
{
¹¹ 	
var
ºº 
user
ºº 
=
ºº 
await
ºº 
GetUser
ºº $
(
ºº$ %
email
ºº% *
)
ºº* +
;
ºº+ ,
if
¼¼ 
(
¼¼ 
user
¼¼ 
==
¼¼ 
null
¼¼ 
)
¼¼ 
{
½½ 
NotifyError
¾¾ 
(
¾¾ 
$str
¾¾ <
)
¾¾< =
;
¾¾= >
return
¿¿ 
false
¿¿ 
;
¿¿ 
}
ÀÀ 
var
ÂÂ 
identityResp
ÂÂ 
=
ÂÂ 
await
ÂÂ $
_userManager
ÂÂ% 1
.
ÂÂ1 2!
ChangePasswordAsync
ÂÂ2 E
(
ÂÂE F
user
ÂÂF J
,
ÂÂJ K
password
ÂÂL T
,
ÂÂT U
token
ÂÂV [
)
ÂÂ[ \
;
ÂÂ\ ]
if
ÅÅ 
(
ÅÅ 
identityResp
ÅÅ 
.
ÅÅ 
	Succeeded
ÅÅ &
)
ÅÅ& '
{
ÆÆ 
return
ÇÇ 
true
ÇÇ 
;
ÇÇ 
}
ÈÈ 
return
ÊÊ 
false
ÊÊ 
;
ÊÊ 
}
ËË 	
private
ÍÍ 
async
ÍÍ 
Task
ÍÍ 
<
ÍÍ 
bool
ÍÍ 
>
ÍÍ  
ChangeEmail
ÍÍ! ,
(
ÍÍ, -
string
ÍÍ- 3
oldEmail
ÍÍ4 <
,
ÍÍ< =
string
ÍÍ> D
newEmail
ÍÍE M
,
ÍÍM N
string
ÍÍO U
token
ÍÍV [
)
ÍÍ[ \
{
ÎÎ 	
var
ÏÏ 
user
ÏÏ 
=
ÏÏ 
await
ÏÏ 
GetUser
ÏÏ $
(
ÏÏ$ %
oldEmail
ÏÏ% -
)
ÏÏ- .
;
ÏÏ. /
if
ÑÑ 
(
ÑÑ 
user
ÑÑ 
==
ÑÑ 
null
ÑÑ 
)
ÑÑ 
{
ÒÒ 
NotifyError
ÓÓ 
(
ÓÓ 
$str
ÓÓ <
)
ÓÓ< =
;
ÓÓ= >
return
ÔÔ 
false
ÔÔ 
;
ÔÔ 
}
ÕÕ 
var
×× 
identityResp
×× 
=
×× 
await
×× $
_userManager
××% 1
.
××1 2
ChangeEmailAsync
××2 B
(
××B C
user
××C G
,
××G H
newEmail
××I Q
,
××Q R
token
××S X
)
××X Y
;
××Y Z
if
ÙÙ 
(
ÙÙ 
identityResp
ÙÙ 
.
ÙÙ 
	Succeeded
ÙÙ &
)
ÙÙ& '
{
ÚÚ 
return
ÛÛ 
true
ÛÛ 
;
ÛÛ 
}
ÜÜ 
return
ŞŞ 
false
ŞŞ 
;
ŞŞ 
}
ßß 	
private
áá 
async
áá 
Task
áá 
<
áá 
bool
áá 
>
áá  
ChangePassword
áá! /
(
áá/ 0
string
áá0 6
email
áá7 <
,
áá< =
string
áá> D
password
ááE M
,
ááM N
string
ááO U
newPassword
ááV a
)
ááa b
{
ââ 	
var
ãã 
user
ãã 
=
ãã 
await
ãã 
GetUser
ãã $
(
ãã$ %
email
ãã% *
)
ãã* +
;
ãã+ ,
if
åå 
(
åå 
user
åå 
==
åå 
null
åå 
)
åå 
{
ææ 
NotifyError
çç 
(
çç 
$str
çç <
)
çç< =
;
çç= >
return
èè 
false
èè 
;
èè 
}
éé 
var
ëë 
identityResp
ëë 
=
ëë 
await
ëë $
_userManager
ëë% 1
.
ëë1 2!
ChangePasswordAsync
ëë2 E
(
ëëE F
user
ëëF J
,
ëëJ K
password
ëëL T
,
ëëT U
newPassword
ëëV a
)
ëëa b
;
ëëb c
if
íí 
(
íí 
identityResp
íí 
.
íí 
	Succeeded
íí &
)
íí& '
{
îî 
return
ïï 
true
ïï 
;
ïï 
}
ğğ 
return
òò 
false
òò 
;
òò 
}
óó 	
private
õõ 
async
õõ 
Task
õõ 
<
õõ 
User
õõ 
>
õõ  
GetUser
õõ! (
(
õõ( )
string
õõ) /
email
õõ0 5
)
õõ5 6
{
öö 	
return
÷÷ 
await
÷÷ 
_userManager
÷÷ %
.
÷÷% &
FindByEmailAsync
÷÷& 6
(
÷÷6 7
email
÷÷7 <
)
÷÷< =
;
÷÷= >
}
øø 	
private
úú 
async
úú 
Task
úú 
	AddClaims
úú $
(
úú$ %
User
úú% )
user
úú* .
)
úú. /
{
ûû 	
switch
üü 
(
üü 
user
üü 
.
üü 
ProfileUser
üü $
.
üü$ %
Type
üü% )
)
üü) *
{
ıı 
case
şş 
(
şş 
int
şş 
)
şş 
TypeProfile
şş &
.
şş& '
Admin
şş' ,
:
şş, -
await
ÿÿ 
AddClaimsAdmin
ÿÿ (
(
ÿÿ( )
user
ÿÿ) -
)
ÿÿ- .
;
ÿÿ. /
break
€€ 
;
€€ 
case
 
(
 
int
 
)
 
TypeProfile
 &
.
& '
Client
' -
:
- .
await
‚‚ 
AddClaimsClient
‚‚ )
(
‚‚) *
user
‚‚* .
)
‚‚. /
;
‚‚/ 0
break
ƒƒ 
;
ƒƒ 
case
„„ 
(
„„ 
int
„„ 
)
„„ 
TypeProfile
„„ &
.
„„& '

Restaurant
„„' 1
:
„„1 2
await
…… !
AddClaimsRestaurant
…… -
(
……- .
user
……. 2
)
……2 3
;
……3 4
break
†† 
;
†† 
}
‡‡ 
}
ˆˆ 	
private
ŠŠ 
async
ŠŠ 
Task
ŠŠ 
AddClaimsAdmin
ŠŠ )
(
ŠŠ) *
User
ŠŠ* .
user
ŠŠ/ 3
)
ŠŠ3 4
{
‹‹ 	
await
 
_userManager
 
.
 
AddClaimAsync
 ,
(
, -
user
- 1
,
1 2
new
3 6
Claim
7 <
(
< =
$str
= C
,
C D
$str
E L
)
L M
)
M N
;
N O
await
 
_userManager
 
.
 
AddClaimAsync
 ,
(
, -
user
- 1
,
1 2
new
3 6
Claim
7 <
(
< =
$str
= N
,
N O
$str
P X
)
X Y
)
Y Z
;
Z [
await
‘‘ 
_userManager
‘‘ 
.
‘‘ 
AddClaimAsync
‘‘ ,
(
‘‘, -
user
‘‘- 1
,
‘‘1 2
new
‘‘3 6
Claim
‘‘7 <
(
‘‘< =
$str
‘‘= N
,
‘‘N O
$str
‘‘P U
)
‘‘U V
)
‘‘V W
;
‘‘W X
await
’’ 
_userManager
’’ 
.
’’ 
AddClaimAsync
’’ ,
(
’’, -
user
’’- 1
,
’’1 2
new
’’3 6
Claim
’’7 <
(
’’< =
$str
’’= N
,
’’N O
$str
’’P X
)
’’X Y
)
’’Y Z
;
’’Z [
await
““ 
_userManager
““ 
.
““ 
AddClaimAsync
““ ,
(
““, -
user
““- 1
,
““1 2
new
““3 6
Claim
““7 <
(
““< =
$str
““= N
,
““N O
$str
““P X
)
““X Y
)
““Y Z
;
““Z [
await
•• 
_userManager
•• 
.
•• 
AddClaimAsync
•• ,
(
••, -
user
••- 1
,
••1 2
new
••3 6
Claim
••7 <
(
••< =
$str
••= Q
,
••Q R
$str
••S [
)
••[ \
)
••\ ]
;
••] ^
await
–– 
_userManager
–– 
.
–– 
AddClaimAsync
–– ,
(
––, -
user
––- 1
,
––1 2
new
––3 6
Claim
––7 <
(
––< =
$str
––= Q
,
––Q R
$str
––S X
)
––X Y
)
––Y Z
;
––Z [
await
—— 
_userManager
—— 
.
—— 
AddClaimAsync
—— ,
(
——, -
user
——- 1
,
——1 2
new
——3 6
Claim
——7 <
(
——< =
$str
——= Q
,
——Q R
$str
——S [
)
——[ \
)
——\ ]
;
——] ^
await
˜˜ 
_userManager
˜˜ 
.
˜˜ 
AddClaimAsync
˜˜ ,
(
˜˜, -
user
˜˜- 1
,
˜˜1 2
new
˜˜3 6
Claim
˜˜7 <
(
˜˜< =
$str
˜˜= Q
,
˜˜Q R
$str
˜˜S [
)
˜˜[ \
)
˜˜\ ]
;
˜˜] ^
await
šš 
_userManager
šš 
.
šš 
AddClaimAsync
šš ,
(
šš, -
user
šš- 1
,
šš1 2
new
šš3 6
Claim
šš7 <
(
šš< =
$str
šš= E
,
ššE F
$str
ššG O
)
ššO P
)
ššP Q
;
ššQ R
await
›› 
_userManager
›› 
.
›› 
AddClaimAsync
›› ,
(
››, -
user
››- 1
,
››1 2
new
››3 6
Claim
››7 <
(
››< =
$str
››= E
,
››E F
$str
››G L
)
››L M
)
››M N
;
››N O
await
œœ 
_userManager
œœ 
.
œœ 
AddClaimAsync
œœ ,
(
œœ, -
user
œœ- 1
,
œœ1 2
new
œœ3 6
Claim
œœ7 <
(
œœ< =
$str
œœ= E
,
œœE F
$str
œœG O
)
œœO P
)
œœP Q
;
œœQ R
await
 
_userManager
 
.
 
AddClaimAsync
 ,
(
, -
user
- 1
,
1 2
new
3 6
Claim
7 <
(
< =
$str
= E
,
E F
$str
G O
)
O P
)
P Q
;
Q R
await
ŸŸ 
_userManager
ŸŸ 
.
ŸŸ 
AddClaimAsync
ŸŸ ,
(
ŸŸ, -
user
ŸŸ- 1
,
ŸŸ1 2
new
ŸŸ3 6
Claim
ŸŸ7 <
(
ŸŸ< =
$str
ŸŸ= C
,
ŸŸC D
$str
ŸŸE M
)
ŸŸM N
)
ŸŸN O
;
ŸŸO P
await
   
_userManager
   
.
   
AddClaimAsync
   ,
(
  , -
user
  - 1
,
  1 2
new
  3 6
Claim
  7 <
(
  < =
$str
  = C
,
  C D
$str
  E J
)
  J K
)
  K L
;
  L M
await
¡¡ 
_userManager
¡¡ 
.
¡¡ 
AddClaimAsync
¡¡ ,
(
¡¡, -
user
¡¡- 1
,
¡¡1 2
new
¡¡3 6
Claim
¡¡7 <
(
¡¡< =
$str
¡¡= C
,
¡¡C D
$str
¡¡E M
)
¡¡M N
)
¡¡N O
;
¡¡O P
await
¢¢ 
_userManager
¢¢ 
.
¢¢ 
AddClaimAsync
¢¢ ,
(
¢¢, -
user
¢¢- 1
,
¢¢1 2
new
¢¢3 6
Claim
¢¢7 <
(
¢¢< =
$str
¢¢= C
,
¢¢C D
$str
¢¢E M
)
¢¢M N
)
¢¢N O
;
¢¢O P
await
¤¤ 
_userManager
¤¤ 
.
¤¤ 
AddClaimAsync
¤¤ ,
(
¤¤, -
user
¤¤- 1
,
¤¤1 2
new
¤¤3 6
Claim
¤¤7 <
(
¤¤< =
$str
¤¤= D
,
¤¤D E
$str
¤¤F N
)
¤¤N O
)
¤¤O P
;
¤¤P Q
await
¥¥ 
_userManager
¥¥ 
.
¥¥ 
AddClaimAsync
¥¥ ,
(
¥¥, -
user
¥¥- 1
,
¥¥1 2
new
¥¥3 6
Claim
¥¥7 <
(
¥¥< =
$str
¥¥= D
,
¥¥D E
$str
¥¥F K
)
¥¥K L
)
¥¥L M
;
¥¥M N
await
¦¦ 
_userManager
¦¦ 
.
¦¦ 
AddClaimAsync
¦¦ ,
(
¦¦, -
user
¦¦- 1
,
¦¦1 2
new
¦¦3 6
Claim
¦¦7 <
(
¦¦< =
$str
¦¦= D
,
¦¦D E
$str
¦¦F N
)
¦¦N O
)
¦¦O P
;
¦¦P Q
await
§§ 
_userManager
§§ 
.
§§ 
AddClaimAsync
§§ ,
(
§§, -
user
§§- 1
,
§§1 2
new
§§3 6
Claim
§§7 <
(
§§< =
$str
§§= D
,
§§D E
$str
§§F N
)
§§N O
)
§§O P
;
§§P Q
await
©© 
_userManager
©© 
.
©© 
AddClaimAsync
©© ,
(
©©, -
user
©©- 1
,
©©1 2
new
©©3 6
Claim
©©7 <
(
©©< =
$str
©©= J
,
©©J K
$str
©©L T
)
©©T U
)
©©U V
;
©©V W
await
ªª 
_userManager
ªª 
.
ªª 
AddClaimAsync
ªª ,
(
ªª, -
user
ªª- 1
,
ªª1 2
new
ªª3 6
Claim
ªª7 <
(
ªª< =
$str
ªª= J
,
ªªJ K
$str
ªªL Q
)
ªªQ R
)
ªªR S
;
ªªS T
await
«« 
_userManager
«« 
.
«« 
AddClaimAsync
«« ,
(
««, -
user
««- 1
,
««1 2
new
««3 6
Claim
««7 <
(
««< =
$str
««= J
,
««J K
$str
««L T
)
««T U
)
««U V
;
««V W
await
¬¬ 
_userManager
¬¬ 
.
¬¬ 
AddClaimAsync
¬¬ ,
(
¬¬, -
user
¬¬- 1
,
¬¬1 2
new
¬¬3 6
Claim
¬¬7 <
(
¬¬< =
$str
¬¬= J
,
¬¬J K
$str
¬¬L T
)
¬¬T U
)
¬¬U V
;
¬¬V W
await
®® 
_userManager
®® 
.
®® 
AddClaimAsync
®® ,
(
®®, -
user
®®- 1
,
®®1 2
new
®®3 6
Claim
®®7 <
(
®®< =
$str
®®= F
,
®®F G
$str
®®H P
)
®®P Q
)
®®Q R
;
®®R S
await
¯¯ 
_userManager
¯¯ 
.
¯¯ 
AddClaimAsync
¯¯ ,
(
¯¯, -
user
¯¯- 1
,
¯¯1 2
new
¯¯3 6
Claim
¯¯7 <
(
¯¯< =
$str
¯¯= F
,
¯¯F G
$str
¯¯H M
)
¯¯M N
)
¯¯N O
;
¯¯O P
await
°° 
_userManager
°° 
.
°° 
AddClaimAsync
°° ,
(
°°, -
user
°°- 1
,
°°1 2
new
°°3 6
Claim
°°7 <
(
°°< =
$str
°°= F
,
°°F G
$str
°°H P
)
°°P Q
)
°°Q R
;
°°R S
await
±± 
_userManager
±± 
.
±± 
AddClaimAsync
±± ,
(
±±, -
user
±±- 1
,
±±1 2
new
±±3 6
Claim
±±7 <
(
±±< =
$str
±±= F
,
±±F G
$str
±±H P
)
±±P Q
)
±±Q R
;
±±R S
await
³³ 
_userManager
³³ 
.
³³ 
AddClaimAsync
³³ ,
(
³³, -
user
³³- 1
,
³³1 2
new
³³3 6
Claim
³³7 <
(
³³< =
$str
³³= F
,
³³F G
$str
³³H P
)
³³P Q
)
³³Q R
;
³³R S
await
´´ 
_userManager
´´ 
.
´´ 
AddClaimAsync
´´ ,
(
´´, -
user
´´- 1
,
´´1 2
new
´´3 6
Claim
´´7 <
(
´´< =
$str
´´= F
,
´´F G
$str
´´H M
)
´´M N
)
´´N O
;
´´O P
await
µµ 
_userManager
µµ 
.
µµ 
AddClaimAsync
µµ ,
(
µµ, -
user
µµ- 1
,
µµ1 2
new
µµ3 6
Claim
µµ7 <
(
µµ< =
$str
µµ= F
,
µµF G
$str
µµH P
)
µµP Q
)
µµQ R
;
µµR S
await
¶¶ 
_userManager
¶¶ 
.
¶¶ 
AddClaimAsync
¶¶ ,
(
¶¶, -
user
¶¶- 1
,
¶¶1 2
new
¶¶3 6
Claim
¶¶7 <
(
¶¶< =
$str
¶¶= F
,
¶¶F G
$str
¶¶H P
)
¶¶P Q
)
¶¶Q R
;
¶¶R S
await
¸¸ 
_userManager
¸¸ 
.
¸¸ 
AddClaimAsync
¸¸ ,
(
¸¸, -
user
¸¸- 1
,
¸¸1 2
new
¸¸3 6
Claim
¸¸7 <
(
¸¸< =
$str
¸¸= I
,
¸¸I J
$str
¸¸K S
)
¸¸S T
)
¸¸T U
;
¸¸U V
await
¹¹ 
_userManager
¹¹ 
.
¹¹ 
AddClaimAsync
¹¹ ,
(
¹¹, -
user
¹¹- 1
,
¹¹1 2
new
¹¹3 6
Claim
¹¹7 <
(
¹¹< =
$str
¹¹= I
,
¹¹I J
$str
¹¹K P
)
¹¹P Q
)
¹¹Q R
;
¹¹R S
await
ºº 
_userManager
ºº 
.
ºº 
AddClaimAsync
ºº ,
(
ºº, -
user
ºº- 1
,
ºº1 2
new
ºº3 6
Claim
ºº7 <
(
ºº< =
$str
ºº= I
,
ººI J
$str
ººK S
)
ººS T
)
ººT U
;
ººU V
await
»» 
_userManager
»» 
.
»» 
AddClaimAsync
»» ,
(
»», -
user
»»- 1
,
»»1 2
new
»»3 6
Claim
»»7 <
(
»»< =
$str
»»= I
,
»»I J
$str
»»K S
)
»»S T
)
»»T U
;
»»U V
}
¼¼ 	
private
¾¾ 
async
¾¾ 
Task
¾¾ 
AddClaimsClient
¾¾ *
(
¾¾* +
User
¾¾+ /
user
¾¾0 4
)
¾¾4 5
{
¿¿ 	
await
ÂÂ 
_userManager
ÂÂ 
.
ÂÂ 
AddClaimAsync
ÂÂ ,
(
ÂÂ, -
user
ÂÂ- 1
,
ÂÂ1 2
new
ÂÂ3 6
Claim
ÂÂ7 <
(
ÂÂ< =
$str
ÂÂ= C
,
ÂÂC D
$str
ÂÂE M
)
ÂÂM N
)
ÂÂN O
;
ÂÂO P
await
ÄÄ 
_userManager
ÄÄ 
.
ÄÄ 
AddClaimAsync
ÄÄ ,
(
ÄÄ, -
user
ÄÄ- 1
,
ÄÄ1 2
new
ÄÄ3 6
Claim
ÄÄ7 <
(
ÄÄ< =
$str
ÄÄ= N
,
ÄÄN O
$str
ÄÄP U
)
ÄÄU V
)
ÄÄV W
;
ÄÄW X
await
ÅÅ 
_userManager
ÅÅ 
.
ÅÅ 
AddClaimAsync
ÅÅ ,
(
ÅÅ, -
user
ÅÅ- 1
,
ÅÅ1 2
new
ÅÅ3 6
Claim
ÅÅ7 <
(
ÅÅ< =
$str
ÅÅ= Q
,
ÅÅQ R
$str
ÅÅS X
)
ÅÅX Y
)
ÅÅY Z
;
ÅÅZ [
await
ÆÆ 
_userManager
ÆÆ 
.
ÆÆ 
AddClaimAsync
ÆÆ ,
(
ÆÆ, -
user
ÆÆ- 1
,
ÆÆ1 2
new
ÆÆ3 6
Claim
ÆÆ7 <
(
ÆÆ< =
$str
ÆÆ= E
,
ÆÆE F
$str
ÆÆG L
)
ÆÆL M
)
ÆÆM N
;
ÆÆN O
await
ÇÇ 
_userManager
ÇÇ 
.
ÇÇ 
AddClaimAsync
ÇÇ ,
(
ÇÇ, -
user
ÇÇ- 1
,
ÇÇ1 2
new
ÇÇ3 6
Claim
ÇÇ7 <
(
ÇÇ< =
$str
ÇÇ= F
,
ÇÇF G
$str
ÇÇH M
)
ÇÇM N
)
ÇÇN O
;
ÇÇO P
await
ÈÈ 
_userManager
ÈÈ 
.
ÈÈ 
AddClaimAsync
ÈÈ ,
(
ÈÈ, -
user
ÈÈ- 1
,
ÈÈ1 2
new
ÈÈ3 6
Claim
ÈÈ7 <
(
ÈÈ< =
$str
ÈÈ= J
,
ÈÈJ K
$str
ÈÈL Q
)
ÈÈQ R
)
ÈÈR S
;
ÈÈS T
await
ÉÉ 
_userManager
ÉÉ 
.
ÉÉ 
AddClaimAsync
ÉÉ ,
(
ÉÉ, -
user
ÉÉ- 1
,
ÉÉ1 2
new
ÉÉ3 6
Claim
ÉÉ7 <
(
ÉÉ< =
$str
ÉÉ= I
,
ÉÉI J
$str
ÉÉK P
)
ÉÉP Q
)
ÉÉQ R
;
ÉÉR S
await
ËË 
_userManager
ËË 
.
ËË 
AddClaimAsync
ËË ,
(
ËË, -
user
ËË- 1
,
ËË1 2
new
ËË3 6
Claim
ËË7 <
(
ËË< =
$str
ËË= C
,
ËËC D
$str
ËËE M
)
ËËM N
)
ËËN O
;
ËËO P
await
ÌÌ 
_userManager
ÌÌ 
.
ÌÌ 
AddClaimAsync
ÌÌ ,
(
ÌÌ, -
user
ÌÌ- 1
,
ÌÌ1 2
new
ÌÌ3 6
Claim
ÌÌ7 <
(
ÌÌ< =
$str
ÌÌ= C
,
ÌÌC D
$str
ÌÌE J
)
ÌÌJ K
)
ÌÌK L
;
ÌÌL M
await
ÍÍ 
_userManager
ÍÍ 
.
ÍÍ 
AddClaimAsync
ÍÍ ,
(
ÍÍ, -
user
ÍÍ- 1
,
ÍÍ1 2
new
ÍÍ3 6
Claim
ÍÍ7 <
(
ÍÍ< =
$str
ÍÍ= C
,
ÍÍC D
$str
ÍÍE M
)
ÍÍM N
)
ÍÍN O
;
ÍÍO P
await
ÎÎ 
_userManager
ÎÎ 
.
ÎÎ 
AddClaimAsync
ÎÎ ,
(
ÎÎ, -
user
ÎÎ- 1
,
ÎÎ1 2
new
ÎÎ3 6
Claim
ÎÎ7 <
(
ÎÎ< =
$str
ÎÎ= C
,
ÎÎC D
$str
ÎÎE M
)
ÎÎM N
)
ÎÎN O
;
ÎÎO P
await
ĞĞ 
_userManager
ĞĞ 
.
ĞĞ 
AddClaimAsync
ĞĞ ,
(
ĞĞ, -
user
ĞĞ- 1
,
ĞĞ1 2
new
ĞĞ3 6
Claim
ĞĞ7 <
(
ĞĞ< =
$str
ĞĞ= D
,
ĞĞD E
$str
ĞĞF N
)
ĞĞN O
)
ĞĞO P
;
ĞĞP Q
await
ÑÑ 
_userManager
ÑÑ 
.
ÑÑ 
AddClaimAsync
ÑÑ ,
(
ÑÑ, -
user
ÑÑ- 1
,
ÑÑ1 2
new
ÑÑ3 6
Claim
ÑÑ7 <
(
ÑÑ< =
$str
ÑÑ= D
,
ÑÑD E
$str
ÑÑF K
)
ÑÑK L
)
ÑÑL M
;
ÑÑM N
await
ÒÒ 
_userManager
ÒÒ 
.
ÒÒ 
AddClaimAsync
ÒÒ ,
(
ÒÒ, -
user
ÒÒ- 1
,
ÒÒ1 2
new
ÒÒ3 6
Claim
ÒÒ7 <
(
ÒÒ< =
$str
ÒÒ= D
,
ÒÒD E
$str
ÒÒF N
)
ÒÒN O
)
ÒÒO P
;
ÒÒP Q
await
ÓÓ 
_userManager
ÓÓ 
.
ÓÓ 
AddClaimAsync
ÓÓ ,
(
ÓÓ, -
user
ÓÓ- 1
,
ÓÓ1 2
new
ÓÓ3 6
Claim
ÓÓ7 <
(
ÓÓ< =
$str
ÓÓ= D
,
ÓÓD E
$str
ÓÓF N
)
ÓÓN O
)
ÓÓO P
;
ÓÓP Q
await
ÕÕ 
_userManager
ÕÕ 
.
ÕÕ 
AddClaimAsync
ÕÕ ,
(
ÕÕ, -
user
ÕÕ- 1
,
ÕÕ1 2
new
ÕÕ3 6
Claim
ÕÕ7 <
(
ÕÕ< =
$str
ÕÕ= F
,
ÕÕF G
$str
ÕÕH M
)
ÕÕM N
)
ÕÕN O
;
ÕÕO P
await
ÖÖ 
_userManager
ÖÖ 
.
ÖÖ 
AddClaimAsync
ÖÖ ,
(
ÖÖ, -
user
ÖÖ- 1
,
ÖÖ1 2
new
ÖÖ3 6
Claim
ÖÖ7 <
(
ÖÖ< =
$str
ÖÖ= F
,
ÖÖF G
$str
ÖÖH P
)
ÖÖP Q
)
ÖÖQ R
;
ÖÖR S
}
×× 	
private
ÙÙ 
async
ÙÙ 
Task
ÙÙ !
AddClaimsRestaurant
ÙÙ .
(
ÙÙ. /
User
ÙÙ/ 3
user
ÙÙ4 8
)
ÙÙ8 9
{
ÚÚ 	
await
İİ 
_userManager
İİ 
.
İİ 
AddClaimAsync
İİ ,
(
İİ, -
user
İİ- 1
,
İİ1 2
new
İİ3 6
Claim
İİ7 <
(
İİ< =
$str
İİ= C
,
İİC D
$str
İİE Q
)
İİQ R
)
İİR S
;
İİS T
await
ßß 
_userManager
ßß 
.
ßß 
AddClaimAsync
ßß ,
(
ßß, -
user
ßß- 1
,
ßß1 2
new
ßß3 6
Claim
ßß7 <
(
ßß< =
$str
ßß= F
,
ßßF G
$str
ßßH P
)
ßßP Q
)
ßßQ R
;
ßßR S
await
àà 
_userManager
àà 
.
àà 
AddClaimAsync
àà ,
(
àà, -
user
àà- 1
,
àà1 2
new
àà3 6
Claim
àà7 <
(
àà< =
$str
àà= F
,
ààF G
$str
ààH M
)
ààM N
)
ààN O
;
ààO P
await
áá 
_userManager
áá 
.
áá 
AddClaimAsync
áá ,
(
áá, -
user
áá- 1
,
áá1 2
new
áá3 6
Claim
áá7 <
(
áá< =
$str
áá= F
,
ááF G
$str
ááH P
)
ááP Q
)
ááQ R
;
ááR S
await
ââ 
_userManager
ââ 
.
ââ 
AddClaimAsync
ââ ,
(
ââ, -
user
ââ- 1
,
ââ1 2
new
ââ3 6
Claim
ââ7 <
(
ââ< =
$str
ââ= F
,
ââF G
$str
ââH P
)
ââP Q
)
ââQ R
;
ââR S
await
ää 
_userManager
ää 
.
ää 
AddClaimAsync
ää ,
(
ää, -
user
ää- 1
,
ää1 2
new
ää3 6
Claim
ää7 <
(
ää< =
$str
ää= E
,
ääE F
$str
ääG O
)
ääO P
)
ääP Q
;
ääQ R
await
åå 
_userManager
åå 
.
åå 
AddClaimAsync
åå ,
(
åå, -
user
åå- 1
,
åå1 2
new
åå3 6
Claim
åå7 <
(
åå< =
$str
åå= E
,
ååE F
$str
ååG L
)
ååL M
)
ååM N
;
ååN O
await
ææ 
_userManager
ææ 
.
ææ 
AddClaimAsync
ææ ,
(
ææ, -
user
ææ- 1
,
ææ1 2
new
ææ3 6
Claim
ææ7 <
(
ææ< =
$str
ææ= E
,
ææE F
$str
ææG O
)
ææO P
)
ææP Q
;
ææQ R
await
èè 
_userManager
èè 
.
èè 
AddClaimAsync
èè ,
(
èè, -
user
èè- 1
,
èè1 2
new
èè3 6
Claim
èè7 <
(
èè< =
$str
èè= I
,
èèI J
$str
èèK S
)
èèS T
)
èèT U
;
èèU V
await
éé 
_userManager
éé 
.
éé 
AddClaimAsync
éé ,
(
éé, -
user
éé- 1
,
éé1 2
new
éé3 6
Claim
éé7 <
(
éé< =
$str
éé= I
,
ééI J
$str
ééK P
)
ééP Q
)
ééQ R
;
ééR S
await
êê 
_userManager
êê 
.
êê 
AddClaimAsync
êê ,
(
êê, -
user
êê- 1
,
êê1 2
new
êê3 6
Claim
êê7 <
(
êê< =
$str
êê= I
,
êêI J
$str
êêK S
)
êêS T
)
êêT U
;
êêU V
await
ìì 
_userManager
ìì 
.
ìì 
AddClaimAsync
ìì ,
(
ìì, -
user
ìì- 1
,
ìì1 2
new
ìì3 6
Claim
ìì7 <
(
ìì< =
$str
ìì= F
,
ììF G
$str
ììH M
)
ììM N
)
ììN O
;
ììO P
await
íí 
_userManager
íí 
.
íí 
AddClaimAsync
íí ,
(
íí, -
user
íí- 1
,
íí1 2
new
íí3 6
Claim
íí7 <
(
íí< =
$str
íí= F
,
ííF G
$str
ííH P
)
ííP Q
)
ííQ R
;
ííR S
await
ïï 
_userManager
ïï 
.
ïï 
AddClaimAsync
ïï ,
(
ïï, -
user
ïï- 1
,
ïï1 2
new
ïï3 6
Claim
ïï7 <
(
ïï< =
$str
ïï= J
,
ïïJ K
$str
ïïL T
)
ïïT U
)
ïïU V
;
ïïV W
await
ğğ 
_userManager
ğğ 
.
ğğ 
AddClaimAsync
ğğ ,
(
ğğ, -
user
ğğ- 1
,
ğğ1 2
new
ğğ3 6
Claim
ğğ7 <
(
ğğ< =
$str
ğğ= J
,
ğğJ K
$str
ğğL Q
)
ğğQ R
)
ğğR S
;
ğğS T
await
ññ 
_userManager
ññ 
.
ññ 
AddClaimAsync
ññ ,
(
ññ, -
user
ññ- 1
,
ññ1 2
new
ññ3 6
Claim
ññ7 <
(
ññ< =
$str
ññ= J
,
ññJ K
$str
ññL T
)
ññT U
)
ññU V
;
ññV W
await
òò 
_userManager
òò 
.
òò 
AddClaimAsync
òò ,
(
òò, -
user
òò- 1
,
òò1 2
new
òò3 6
Claim
òò7 <
(
òò< =
$str
òò= J
,
òòJ K
$str
òòL T
)
òòT U
)
òòU V
;
òòV W
await
ôô 
_userManager
ôô 
.
ôô 
AddClaimAsync
ôô ,
(
ôô, -
user
ôô- 1
,
ôô1 2
new
ôô3 6
Claim
ôô7 <
(
ôô< =
$str
ôô= D
,
ôôD E
$str
ôôF K
)
ôôK L
)
ôôL M
;
ôôM N
await
õõ 
_userManager
õõ 
.
õõ 
AddClaimAsync
õõ ,
(
õõ, -
user
õõ- 1
,
õõ1 2
new
õõ3 6
Claim
õõ7 <
(
õõ< =
$str
õõ= D
,
õõD E
$str
õõF N
)
õõN O
)
õõO P
;
õõP Q
await
öö 
_userManager
öö 
.
öö 
AddClaimAsync
öö ,
(
öö, -
user
öö- 1
,
öö1 2
new
öö3 6
Claim
öö7 <
(
öö< =
$str
öö= D
,
ööD E
$str
ööF N
)
ööN O
)
ööO P
;
ööP Q
await
øø 
_userManager
øø 
.
øø 
AddClaimAsync
øø ,
(
øø, -
user
øø- 1
,
øø1 2
new
øø3 6
Claim
øø7 <
(
øø< =
$str
øø= Q
,
øøQ R
$str
øøS [
)
øø[ \
)
øø\ ]
;
øø] ^
await
ùù 
_userManager
ùù 
.
ùù 
AddClaimAsync
ùù ,
(
ùù, -
user
ùù- 1
,
ùù1 2
new
ùù3 6
Claim
ùù7 <
(
ùù< =
$str
ùù= Q
,
ùùQ R
$str
ùùS X
)
ùùX Y
)
ùùY Z
;
ùùZ [
await
úú 
_userManager
úú 
.
úú 
AddClaimAsync
úú ,
(
úú, -
user
úú- 1
,
úú1 2
new
úú3 6
Claim
úú7 <
(
úú< =
$str
úú= Q
,
úúQ R
$str
úúS [
)
úú[ \
)
úú\ ]
;
úú] ^
await
üü 
_userManager
üü 
.
üü 
AddClaimAsync
üü ,
(
üü, -
user
üü- 1
,
üü1 2
new
üü3 6
Claim
üü7 <
(
üü< =
$str
üü= N
,
üüN O
$str
üüP X
)
üüX Y
)
üüY Z
;
üüZ [
await
ıı 
_userManager
ıı 
.
ıı 
AddClaimAsync
ıı ,
(
ıı, -
user
ıı- 1
,
ıı1 2
new
ıı3 6
Claim
ıı7 <
(
ıı< =
$str
ıı= N
,
ııN O
$str
ııP U
)
ııU V
)
ııV W
;
ııW X
await
şş 
_userManager
şş 
.
şş 
AddClaimAsync
şş ,
(
şş, -
user
şş- 1
,
şş1 2
new
şş3 6
Claim
şş7 <
(
şş< =
$str
şş= N
,
şşN O
$str
şşP X
)
şşX Y
)
şşY Z
;
şşZ [
}
ÿÿ 	
public
‚‚ 
async
‚‚ 
Task
‚‚ 
<
‚‚ $
LoginResponseViewModel
‚‚ 0
>
‚‚0 1
GetJwt
‚‚2 8
(
‚‚8 9
string
‚‚9 ?
email
‚‚@ E
)
‚‚E F
{
ƒƒ 	
var
„„ 
user
„„ 
=
„„ 
await
„„ 
_userManager
„„ )
.
„„) *
FindByEmailAsync
„„* :
(
„„: ;
email
„„; @
)
„„@ A
;
„„A B
var
…… 
claims
…… 
=
…… 
await
…… 
_userManager
…… +
.
……+ ,
GetClaimsAsync
……, :
(
……: ;
user
……; ?
)
……? @
;
……@ A
var
†† 
	userRoles
†† 
=
†† 
await
†† !
_userManager
††" .
.
††. /
GetRolesAsync
††/ <
(
††< =
user
††= A
)
††A B
;
††B C
claims
ˆˆ 
.
ˆˆ 
Add
ˆˆ 
(
ˆˆ 
new
ˆˆ 
Claim
ˆˆ  
(
ˆˆ  !%
JwtRegisteredClaimNames
ˆˆ! 8
.
ˆˆ8 9
Sub
ˆˆ9 <
,
ˆˆ< =
user
ˆˆ> B
.
ˆˆB C
Id
ˆˆC E
.
ˆˆE F
ToString
ˆˆF N
(
ˆˆN O
)
ˆˆO P
)
ˆˆP Q
)
ˆˆQ R
;
ˆˆR S
claims
‰‰ 
.
‰‰ 
Add
‰‰ 
(
‰‰ 
new
‰‰ 
Claim
‰‰  
(
‰‰  !%
JwtRegisteredClaimNames
‰‰! 8
.
‰‰8 9
Email
‰‰9 >
,
‰‰> ?
user
‰‰@ D
.
‰‰D E
Email
‰‰E J
)
‰‰J K
)
‰‰K L
;
‰‰L M
claims
ŠŠ 
.
ŠŠ 
Add
ŠŠ 
(
ŠŠ 
new
ŠŠ 
Claim
ŠŠ  
(
ŠŠ  !%
JwtRegisteredClaimNames
ŠŠ! 8
.
ŠŠ8 9
Jti
ŠŠ9 <
,
ŠŠ< =
Guid
ŠŠ> B
.
ŠŠB C
NewGuid
ŠŠC J
(
ŠŠJ K
)
ŠŠK L
.
ŠŠL M
ToString
ŠŠM U
(
ŠŠU V
)
ŠŠV W
)
ŠŠW X
)
ŠŠX Y
;
ŠŠY Z
claims
‹‹ 
.
‹‹ 
Add
‹‹ 
(
‹‹ 
new
‹‹ 
Claim
‹‹  
(
‹‹  !%
JwtRegisteredClaimNames
‹‹! 8
.
‹‹8 9
Nbf
‹‹9 <
,
‹‹< =
ToUnixEpochDate
‹‹> M
(
‹‹M N
DateTime
‹‹N V
.
‹‹V W
UtcNow
‹‹W ]
)
‹‹] ^
.
‹‹^ _
ToString
‹‹_ g
(
‹‹g h
)
‹‹h i
)
‹‹i j
)
‹‹j k
;
‹‹k l
claims
ŒŒ 
.
ŒŒ 
Add
ŒŒ 
(
ŒŒ 
new
ŒŒ 
Claim
ŒŒ  
(
ŒŒ  !%
JwtRegisteredClaimNames
ŒŒ! 8
.
ŒŒ8 9
Iat
ŒŒ9 <
,
ŒŒ< =
ToUnixEpochDate
ŒŒ> M
(
ŒŒM N
DateTime
ŒŒN V
.
ŒŒV W
UtcNow
ŒŒW ]
)
ŒŒ] ^
.
ŒŒ^ _
ToString
ŒŒ_ g
(
ŒŒg h
)
ŒŒh i
,
ŒŒi j
ClaimValueTypes
ŒŒk z
.
ŒŒz {
	Integer64ŒŒ{ „
)ŒŒ„ …
)ŒŒ… †
;ŒŒ† ‡
foreach
 
(
 
var
 
userRole
 !
in
" $
	userRoles
% .
)
. /
{
 
claims
 
.
 
Add
 
(
 
new
 
Claim
 $
(
$ %
$str
% +
,
+ ,
userRole
- 5
)
5 6
)
6 7
;
7 8
}
‘‘ 
var
““ 
identityClaims
““ 
=
““  
new
““! $
ClaimsIdentity
““% 3
(
““3 4
claims
““4 :
)
““: ;
;
““; <
var
•• 
tokenHandler
•• 
=
•• 
new
•• "%
JwtSecurityTokenHandler
••# :
(
••: ;
)
••; <
;
••< =
var
–– 
key
–– 
=
–– 
Encoding
–– 
.
–– 
ASCII
–– $
.
––$ %
GetBytes
––% -
(
––- .
_appSettings
––. :
.
––: ;
Secret
––; A
)
––A B
;
––B C
var
—— 
token
—— 
=
—— 
tokenHandler
—— $
.
——$ %
CreateToken
——% 0
(
——0 1
new
——1 4%
SecurityTokenDescriptor
——5 L
{
˜˜ 
Issuer
™™ 
=
™™ 
_appSettings
™™ %
.
™™% &
Issuer
™™& ,
,
™™, -
Audience
šš 
=
šš 
_appSettings
šš '
.
šš' (
ValidOn
šš( /
,
šš/ 0
Subject
›› 
=
›› 
identityClaims
›› (
,
››( )
Expires
œœ 
=
œœ 
DateTime
œœ "
.
œœ" #
UtcNow
œœ# )
.
œœ) *
AddHours
œœ* 2
(
œœ2 3
_appSettings
œœ3 ?
.
œœ? @
ExpirationHours
œœ@ O
)
œœO P
,
œœP Q 
SigningCredentials
 "
=
# $
new
% ( 
SigningCredentials
) ;
(
; <
new
< ?"
SymmetricSecurityKey
@ T
(
T U
key
U X
)
X Y
,
Y Z 
SecurityAlgorithms
[ m
.
m n"
HmacSha256Signaturen 
) ‚
}
 
)
 
;
 
var
   
encodedToken
   
=
   
tokenHandler
   +
.
  + ,

WriteToken
  , 6
(
  6 7
token
  7 <
)
  < =
;
  = >
var
¢¢ 
	userToken
¢¢ 
=
¢¢ 
new
¢¢  
UserTokenViewModel
¢¢  2
(
¢¢2 3
user
¢¢3 7
.
¢¢7 8
Id
¢¢8 :
.
¢¢: ;
ToString
¢¢; C
(
¢¢C D
)
¢¢D E
,
¢¢E F
user
¢¢G K
.
¢¢K L
Email
¢¢L Q
,
¢¢Q R
claims
¢¢S Y
)
¢¢Y Z
;
¢¢Z [
var
¤¤ 
profile
¤¤ 
=
¤¤ 
await
¤¤ $
_profileUserRepository
¤¤  6
.
¤¤6 7
GetById
¤¤7 >
(
¤¤> ?
user
¤¤? C
.
¤¤C D
IdProfileUser
¤¤D Q
)
¤¤Q R
;
¤¤R S
if
¦¦ 
(
¦¦ 
profile
¦¦ 
!=
¦¦ 
null
¦¦ 
)
¦¦  
{
§§ 
	userToken
¨¨ 
.
¨¨ 
Profile
¨¨ !
=
¨¨" #
new
¨¨$ '
ProfileViewModel
¨¨( 8
(
¨¨8 9
)
¨¨9 :
;
¨¨: ;
	userToken
©© 
.
©© 
Profile
©© !
.
©©! "
	BirthDate
©©" +
=
©©, -
profile
©©. 5
.
©©5 6
	BirthDate
©©6 ?
;
©©? @
	userToken
ªª 
.
ªª 
Profile
ªª !
.
ªª! "
Name
ªª" &
=
ªª' (
profile
ªª) 0
.
ªª0 1
Name
ªª1 5
;
ªª5 6
	userToken
«« 
.
«« 
Profile
«« !
.
««! "
LastName
««" *
=
««+ ,
profile
««- 4
.
««4 5
LastName
««5 =
;
««= >
switch
­­ 
(
­­ 
profile
­­ 
.
­­  
Type
­­  $
)
­­$ %
{
®® 
case
¯¯ 
$num
¯¯ 
:
¯¯ 
	userToken
°° !
.
°°! "
Profile
°°" )
.
°°) *
Type
°°* .
=
°°/ 0
TypeProfile
°°1 <
.
°°< =
Admin
°°= B
.
°°B C
ToString
°°C K
(
°°K L
)
°°L M
;
°°M N
break
±± 
;
±± 
case
²² 
$num
²² 
:
²² 
	userToken
³³ !
.
³³! "
Profile
³³" )
.
³³) *
Type
³³* .
=
³³/ 0
TypeProfile
³³1 <
.
³³< =
Client
³³= C
.
³³C D
ToString
³³D L
(
³³L M
)
³³M N
;
³³N O
break
µµ 
;
µµ 
case
¶¶ 
$num
¶¶ 
:
¶¶ 
	userToken
·· !
.
··! "
Profile
··" )
.
··) *
Type
··* .
=
··/ 0
TypeProfile
··1 <
.
··< =

Restaurant
··= G
.
··G H
ToString
··H P
(
··P Q
)
··Q R
;
··R S
break
¸¸ 
;
¸¸ 
default
¹¹ 
:
¹¹ 
throw
ºº 
new
ºº !
	Exception
ºº" +
(
ºº+ ,
$str
ºº, ;
)
ºº; <
;
ºº< =
}
»» 
if
½½ 
(
½½ 
profile
½½ 
.
½½ 
AddressUser
½½ &
!=
½½' )
null
½½* .
)
½½. /
{
¾¾ 
	userToken
¿¿ 
.
¿¿ 
Address
¿¿ %
=
¿¿& '
new
¿¿( +
AddressViewModel
¿¿, <
(
¿¿< =
)
¿¿= >
;
¿¿> ?
	userToken
ÀÀ 
.
ÀÀ 
Address
ÀÀ %
.
ÀÀ% &
Street
ÀÀ& ,
=
ÀÀ- .
profile
ÀÀ/ 6
.
ÀÀ6 7
AddressUser
ÀÀ7 B
.
ÀÀB C
Street
ÀÀC I
;
ÀÀI J
	userToken
ÁÁ 
.
ÁÁ 
Address
ÁÁ %
.
ÁÁ% &
District
ÁÁ& .
=
ÁÁ/ 0
profile
ÁÁ1 8
.
ÁÁ8 9
AddressUser
ÁÁ9 D
.
ÁÁD E
District
ÁÁE M
;
ÁÁM N
	userToken
ÂÂ 
.
ÂÂ 
Address
ÂÂ %
.
ÂÂ% &
County
ÂÂ& ,
=
ÂÂ- .
profile
ÂÂ/ 6
.
ÂÂ6 7
AddressUser
ÂÂ7 B
.
ÂÂB C
County
ÂÂC I
;
ÂÂI J
	userToken
ÃÃ 
.
ÃÃ 
Address
ÃÃ %
.
ÃÃ% &
City
ÃÃ& *
=
ÃÃ+ ,
profile
ÃÃ- 4
.
ÃÃ4 5
AddressUser
ÃÃ5 @
.
ÃÃ@ A
City
ÃÃA E
;
ÃÃE F
	userToken
ÄÄ 
.
ÄÄ 
Address
ÄÄ %
.
ÄÄ% &
ZipCode
ÄÄ& -
=
ÄÄ. /
profile
ÄÄ0 7
.
ÄÄ7 8
AddressUser
ÄÄ8 C
.
ÄÄC D
ZipCode
ÄÄD K
;
ÄÄK L
	userToken
ÅÅ 
.
ÅÅ 
Address
ÅÅ %
.
ÅÅ% &
Latitude
ÅÅ& .
=
ÅÅ/ 0
profile
ÅÅ1 8
.
ÅÅ8 9
AddressUser
ÅÅ9 D
.
ÅÅD E
Latitude
ÅÅE M
;
ÅÅM N
	userToken
ÆÆ 
.
ÆÆ 
Address
ÆÆ %
.
ÆÆ% &
	Longitude
ÆÆ& /
=
ÆÆ0 1
profile
ÆÆ2 9
.
ÆÆ9 :
AddressUser
ÆÆ: E
.
ÆÆE F
	Longitude
ÆÆF O
;
ÆÆO P
}
ÇÇ 
}
ÈÈ 
var
ÊÊ 
response
ÊÊ 
=
ÊÊ 
new
ÊÊ $
LoginResponseViewModel
ÊÊ 5
{
ËË 
AccessToken
ÌÌ 
=
ÌÌ 
encodedToken
ÌÌ *
,
ÌÌ* +
	ExpiresIn
ÍÍ 
=
ÍÍ 
TimeSpan
ÍÍ $
.
ÍÍ$ %
	FromHours
ÍÍ% .
(
ÍÍ. /
_appSettings
ÍÍ/ ;
.
ÍÍ; <
ExpirationHours
ÍÍ< K
)
ÍÍK L
.
ÍÍL M
TotalSeconds
ÍÍM Y
,
ÍÍY Z
	UserToken
ÎÎ 
=
ÎÎ 
	userToken
ÎÎ %
}
ÏÏ 
;
ÏÏ 
return
ÑÑ 
response
ÑÑ 
;
ÑÑ 
}
ÒÒ 	
private
ÔÔ 
static
ÔÔ 
long
ÔÔ 
ToUnixEpochDate
ÔÔ +
(
ÔÔ+ ,
DateTime
ÔÔ, 4
date
ÔÔ5 9
)
ÔÔ9 :
=>
ÕÕ 
(
ÕÕ 
long
ÕÕ 
)
ÕÕ 
Math
ÕÕ 
.
ÕÕ 
Round
ÕÕ 
(
ÕÕ 
(
ÕÕ  
date
ÕÕ  $
.
ÕÕ$ %
ToUniversalTime
ÕÕ% 4
(
ÕÕ4 5
)
ÕÕ5 6
-
ÕÕ7 8
new
ÕÕ9 <
DateTimeOffset
ÕÕ= K
(
ÕÕK L
$num
ÕÕL P
,
ÕÕP Q
$num
ÕÕR S
,
ÕÕS T
$num
ÕÕU V
,
ÕÕV W
$num
ÕÕX Y
,
ÕÕY Z
$num
ÕÕ[ \
,
ÕÕ\ ]
$num
ÕÕ^ _
,
ÕÕ_ `
TimeSpan
ÕÕa i
.
ÕÕi j
Zero
ÕÕj n
)
ÕÕn o
)
ÕÕo p
.
ÕÕp q
TotalSeconds
ÕÕq }
)
ÕÕ} ~
;
ÕÕ~ 
}
ÖÖ 
}×× ³
KD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\BaseService.cs
	namespace

 	
IHunger


 
.

 
Service

 
{ 
public 

abstract 
class 
BaseService %
{ 
private 
readonly 
	INotifier "
	_notifier# ,
;, -
	protected 
BaseService 
( 
	INotifier '
notifier( 0
)0 1
{ 	
	_notifier 
= 
notifier  
;  !
} 	
	protected 
void 
NotifyError "
(" #
ValidationResult# 3
validationResult4 D
)D E
{ 	
foreach 
( 
var 
error 
in !
validationResult" 2
.2 3
Errors3 9
)9 :
{ 
NotifyError 
( 
error !
.! "
ErrorMessage" .
). /
;/ 0
} 
} 	
	protected 
void 
NotifyError "
(" #
string# )
mensagem* 2
)2 3
{ 	
	_notifier 
. 
Handle 
( 
new  
Notification! -
(- .
mensagem. 6
)6 7
)7 8
;8 9
}   	
	protected"" 
bool"" 
Validate"" 
<""  
TV""  "
,""" #
TE""$ &
>""& '
(""' (
TV""( *

validation""+ 5
,""5 6
TE""7 9
entity"": @
)""@ A
where""B G
TV""H J
:""K L
AbstractValidator""M ^
<""^ _
TE""_ a
>""a b
where""c h
TE""i k
:""l m
Entity""n t
{## 	
var$$ 
	validator$$ 
=$$ 

validation$$ &
.$$& '
Validate$$' /
($$/ 0
entity$$0 6
)$$6 7
;$$7 8
if&& 
(&& 
	validator&& 
.&& 
IsValid&& !
)&&! "
return&&# )
true&&* .
;&&. /
NotifyError(( 
((( 
	validator(( !
)((! "
;((" #
return** 
false** 
;** 
}++ 	
},, 
}-- Œ
VD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\CategoryProductService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class "
CategoryProductService '
:( )
BaseService* 5
,5 6#
ICategoryProductService7 N
{ 
private 
readonly &
ICategoryProductRepository 3&
_categoryProductRepository4 N
;N O
public "
CategoryProductService %
(% &
	INotifier 
notifier 
, &
ICategoryProductRepository &%
categoryProductRepository' @
)@ A
:B C
baseD H
(H I
notifierI Q
)Q R
{ 	&
_categoryProductRepository &
=' (%
categoryProductRepository) B
;B C
} 	
public 
async 
Task 
< 
CategoryProduct )
>) *
Create+ 1
(1 2
CategoryProduct2 A
categoryProductB Q
)Q R
{ 	
if 
( 
! 
Validate 
( 
new %
CategoryProductValidation 7
(7 8
)8 9
,9 :
categoryProduct; J
)J K
)K L
returnM S
nullT X
;X Y
var 
categoryProductBD !
=" #
await% *&
_categoryProductRepository+ E
. 
Search 
( 
x 
=> 
x 
. 
Name #
==$ &
categoryProduct' 6
.6 7
Name7 ;
); <
;< =
if!! 
(!! 
categoryProductBD!!  
!=!!! #
null!!$ (
&&!!) +
categoryProductBD!!, =
.!!= >
Any!!> A
(!!A B
)!!B C
)!!C D
{"" 
NotifyError## 
(## 
$str## J
)##J K
;##K L
return$$ 
await$$ 
Task$$ !
.$$! "

FromResult$$" ,
<$$, -
CategoryProduct$$- <
>$$< =
($$= >
null$$> B
)$$B C
;$$C D
}%% 
await'' &
_categoryProductRepository'' ,
.(( 
Add(( 
((( 
categoryProduct(( $
)(($ %
;((% &
if** 
(** 
await** &
_categoryProductRepository** /
.**/ 0
Commit**0 6
(**6 7
)**7 8
)**8 9
{++ 
return,, 
await,, 
Task,, !
.,,! "

FromResult,," ,
(,,, -
categoryProduct,,- <
),,< =
;,,= >
}-- 
NotifyError// 
(// 
$str// 0
)//0 1
;//1 2
return00 
await00 
Task00 
.00 

FromResult00 (
<00( )
CategoryProduct00) 8
>008 9
(009 :
null00: >
)00> ?
;00? @
}11 	
public33 
async33 
Task33 
<33 
List33 
<33 
CategoryProduct33 .
>33. /
>33/ 0
GetAll331 7
(337 8
)338 9
{44 	
return55 
await55 &
_categoryProductRepository55 3
.66 
GetAll66 
(66 
)66 
;66 
}77 	
public99 
async99 
Task99 
<99 
List99 
<99 
CategoryProduct99 .
>99. /
>99/ 0
GetAllWithFilter991 A
(99A B!
CategoryProductFilter99B W!
categoryProductFilter99X m
)99m n
{:: 	

Expression;; 
<;; 
Func;; 
<;; 
CategoryProduct;; +
,;;+ ,
bool;;- 1
>;;1 2
>;;2 3
filter;;4 :
=;;; <
null;;= A
;;;A B
Func<< 
<<< 

IQueryable<< 
<<< 
CategoryProduct<< +
><<+ ,
,<<, -
IOrderedQueryable<<. ?
<<<? @
CategoryProduct<<@ O
><<O P
><<P Q
ordeBy<<R X
=<<Y Z
null<<[ _
;<<_ `
if>> 
(>> 
!>> 
string>> 
.>> 
IsNullOrWhiteSpace>> *
(>>* +!
categoryProductFilter>>+ @
.>>@ A
Name>>A E
)>>E F
)>>F G
{?? 
if@@ 
(@@ 
filter@@ 
==@@ 
null@@ !
)@@! "
{AA 
filterBB 
=BB 
PredicateBuilderBB -
.BB- .
NewBB. 1
<BB1 2
CategoryProductBB2 A
>BBA B
(BBB C
trueBBC G
)BBG H
;BBH I
}CC 
filterEE 
=EE 
filterEE 
.EE  
AndEE  #
(EE# $
xEE$ %
=>EE& (
xEE) *
.EE* +
NameEE+ /
==EE0 2!
categoryProductFilterEE3 H
.EEH I
NameEEI M
||EEN P
xEEQ R
.EER S
NameEES W
.EEW X
ContainsEEX `
(EE` a!
categoryProductFilterEEa v
.EEv w
NameEEw {
)EE{ |
)EE| }
;EE} ~
}FF 
ifHH 
(HH 
!HH 
stringHH 
.HH 
IsNullOrWhiteSpaceHH *
(HH* +!
categoryProductFilterHH+ @
.HH@ A
DescriptionHHA L
)HHL M
)HHM N
{II 
ifJJ 
(JJ 
filterJJ 
==JJ 
nullJJ "
)JJ" #
{KK 
filterLL 
=LL 
PredicateBuilderLL -
.LL- .
NewLL. 1
<LL1 2
CategoryProductLL2 A
>LLA B
(LLB C
trueLLC G
)LLG H
;LLH I
}MM 
filterOO 
=OO 
filterOO 
.OO  
AndOO  #
(OO# $
xOO$ %
=>OO& (
xOO) *
.OO* +
DescriptionOO+ 6
==OO7 9!
categoryProductFilterOO: O
.OOO P
DescriptionOOP [
||OO\ ^
xOO_ `
.OO` a
NameOOa e
.OOe f
ContainsOOf n
(OOn o"
categoryProductFilter	OOo „
.
OO„ …
Description
OO… 
)
OO ‘
)
OO‘ ’
;
OO’ “
}PP 
ifRR 
(RR 
!RR 
stringRR 
.RR 
IsNullOrWhiteSpaceRR *
(RR* +!
categoryProductFilterRR+ @
.RR@ A
OrderRRA F
)RRF G
)RRG H
{SS 
switchTT 
(TT !
categoryProductFilterTT -
.TT- .
OrderTT. 3
)TT3 4
{UU 
caseVV 
$strVV 
:VV 
ordeByWW 
=WW  
xWW! "
=>WW# %
xWW& '
.WW' (
OrderByWW( /
(WW/ 0
nWW0 1
=>WW2 4
nWW5 6
.WW6 7
IdWW7 9
)WW9 :
;WW: ;
breakXX 
;XX 
caseYY 
$strYY 
:YY  
ordeByZZ 
=ZZ  
xZZ! "
=>ZZ# %
xZZ& '
.ZZ' (
OrderByZZ( /
(ZZ/ 0
nZZ0 1
=>ZZ2 4
nZZ5 6
.ZZ6 7
NameZZ7 ;
)ZZ; <
;ZZ< =
break[[ 
;[[ 
case\\ 
$str\\ &
:\\& '
ordeBy]] 
=]]  
x]]! "
=>]]# %
x]]& '
.]]' (
OrderBy]]( /
(]]/ 0
n]]0 1
=>]]2 4
n]]5 6
.]]6 7
Description]]7 B
)]]B C
;]]C D
break^^ 
;^^ 
case__ 
$str__ $
:__$ %
ordeBy`` 
=``  
x``! "
=>``# %
x``& '
.``' (
OrderBy``( /
(``/ 0
n``0 1
=>``2 4
n``5 6
.``6 7
	CreatedAt``7 @
)``@ A
;``A B
breakaa 
;aa 
casebb 
$strbb $
:bb$ %
ordeBycc 
=cc  
xcc! "
=>cc# %
xcc& '
.cc' (
OrderBycc( /
(cc/ 0
ncc0 1
=>cc2 4
ncc5 6
.cc6 7
	CreatedAtcc7 @
)cc@ A
;ccA B
breakdd 
;dd 
}ee 
}ff 
ifhh 
(hh !
categoryProductFilterhh $
.hh$ %
Idhh% '
!=hh( *
Guidhh+ /
.hh/ 0
Emptyhh0 5
)hh5 6
{ii 
ifjj 
(jj 
filterjj 
==jj 
nulljj "
)jj" #
{kk 
filterll 
=ll 
PredicateBuilderll -
.ll- .
Newll. 1
<ll1 2
CategoryProductll2 A
>llA B
(llB C
truellC G
)llG H
;llH I
}mm 
filteroo 
=oo 
filteroo 
.oo  
Andoo  #
(oo# $
xoo$ %
=>oo& (
xoo) *
.oo* +
Idoo+ -
==oo. 0!
categoryProductFilteroo1 F
.ooF G
IdooG I
)ooI J
;ooJ K
}pp 
ifrr 
(rr !
categoryProductFilterrr %
.rr% &
	CreatedAtrr& /
.rr/ 0
Yearrr0 4
>rr5 6
$numrr7 8
)rr8 9
{ss 
iftt 
(tt 
filtertt 
==tt 
nulltt "
)tt" #
{uu 
filtervv 
=vv 
PredicateBuildervv -
.vv- .
Newvv. 1
<vv1 2
CategoryProductvv2 A
>vvA B
(vvB C
truevvC G
)vvG H
;vvH I
}ww 
filteryy 
=yy 
filteryy 
.yy  
Andyy  #
(yy# $
xyy$ %
=>yy& (
xyy) *
.yy* +
Idyy+ -
==yy. 0!
categoryProductFilteryy1 F
.yyF G
IdyyG I
)yyI J
;yyJ K
}zz 
return|| 
await|| &
_categoryProductRepository|| 3
.}} 
Search}} 
(}} 
filter~~ 
,~~ 
ordeBy 
, #
categoryProductFilter
€€ )
.
€€) *
PageSize
€€* 2
,
€€2 3#
categoryProductFilter
 )
.
) *
	PageIndex
* 3
)
3 4
;
4 5
}
‚‚ 	
public
„„ 
async
„„ 
Task
„„ 
<
„„ 
CategoryProduct
„„ )
>
„„) *
GetById
„„+ 2
(
„„2 3
Guid
„„3 7
id
„„8 :
)
„„: ;
{
…… 	
return
†† 
await
†† (
_categoryProductRepository
†† 3
.
‡‡ 
GetById
‡‡ 
(
‡‡ 
id
‡‡ 
)
‡‡ 
;
‡‡ 
}
ˆˆ 	
public
ŠŠ 
async
ŠŠ 
Task
ŠŠ 
<
ŠŠ 
CategoryProduct
ŠŠ )
>
ŠŠ) *
Update
ŠŠ+ 1
(
ŠŠ1 2
CategoryProduct
ŠŠ2 A
categoryProduct
ŠŠB Q
)
ŠŠQ R
{
‹‹ 	
if
ŒŒ 
(
ŒŒ 
!
ŒŒ 
Validate
ŒŒ 
(
ŒŒ 
new
ŒŒ '
CategoryProductValidation
ŒŒ 7
(
ŒŒ7 8
)
ŒŒ8 9
,
ŒŒ9 :
categoryProduct
ŒŒ; J
)
ŒŒJ K
)
ŒŒK L
return
ŒŒM S
null
ŒŒT X
;
ŒŒX Y
var
 
categoryProductDb
 !
=
" #
await
$ )(
_categoryProductRepository
* D
.
 
GetById
 
(
 
categoryProduct
 (
.
( )
Id
) +
)
+ ,
;
, -
if
‘‘ 
(
‘‘ 
categoryProductDb
‘‘ !
==
‘‘" $
null
‘‘% )
)
‘‘) *
{
’’ 
NotifyError
““ 
(
““ 
$str
““ '
)
““' (
;
““( )
return
”” 
await
”” 
Task
”” !
.
””! "

FromResult
””" ,
<
””, -
CategoryProduct
””- <
>
””< =
(
””= >
null
””> B
)
””B C
;
””C D
}
•• 
if
—— 
(
—— 
categoryProductDb
—— !
.
——! "
Name
——" &
!=
——' )
categoryProduct
——* 9
.
——9 :
Name
——: >
)
——> ?
{
˜˜ 
categoryProductDb
™™ !
.
™™! "
Name
™™" &
=
™™' (
categoryProduct
™™) 8
.
™™8 9
Name
™™9 =
;
™™= >
}
šš 
if
œœ 
(
œœ 
categoryProductDb
œœ !
.
œœ! "
Description
œœ" -
!=
œœ. 0
categoryProduct
œœ1 @
.
œœ@ A
Description
œœA L
)
œœL M
{
 
categoryProductDb
 !
.
! "
Description
" -
=
. /
categoryProduct
0 ?
.
? @
Description
@ K
;
K L
}
ŸŸ (
_categoryProductRepository
¡¡ &
.
¢¢ 
Update
¢¢ 
(
¢¢ 
categoryProductDb
¢¢ *
)
¢¢* +
;
¢¢+ ,
if
¤¤ 
(
¤¤ 
await
¤¤ (
_categoryProductRepository
¤¤ 0
.
¤¤0 1
Commit
¤¤1 7
(
¤¤7 8
)
¤¤8 9
)
¤¤9 :
{
¥¥ 
return
¦¦ 
await
¦¦ 
Task
¦¦ !
.
¦¦! "

FromResult
¦¦" ,
<
¦¦, -
CategoryProduct
¦¦- <
>
¦¦< =
(
¦¦= >
categoryProductDb
¦¦> O
)
¦¦O P
;
¦¦P Q
}
§§ 
NotifyError
©© 
(
©© 
$str
©© /
)
©©/ 0
;
©©0 1
return
ªª 
await
ªª 
Task
ªª 
.
ªª 

FromResult
ªª (
<
ªª( )
CategoryProduct
ªª) 8
>
ªª8 9
(
ªª9 :
null
ªª: >
)
ªª> ?
;
ªª? @
}
«« 	
public
­­ 
async
­­ 
Task
­­ 
<
­­ 
CategoryProduct
­­ )
>
­­) *
Delete
­­+ 1
(
­­1 2
Guid
­­2 6
id
­­7 9
)
­­9 :
{
®® 	
var
¯¯ 
categoryProduct
¯¯ 
=
¯¯  !
await
¯¯" '(
_categoryProductRepository
¯¯( B
.
°° 
GetById
°° 
(
°° 
id
°° 
)
°° 
;
°° 
if
²² 
(
²² 
categoryProduct
²² 
==
²² !
null
²²" &
)
²²& '
{
³³ 
NotifyError
´´ 
(
´´ 
$str
´´ '
)
´´' (
;
´´( )
return
µµ 
await
µµ 
Task
µµ !
.
µµ! "

FromResult
µµ" ,
<
µµ, -
CategoryProduct
µµ- <
>
µµ< =
(
µµ= >
null
µµ> B
)
µµB C
;
µµC D
}
¶¶ (
_categoryProductRepository
¸¸ &
.
¹¹ 
Remove
¹¹ 
(
¹¹ 
id
¹¹ 
)
¹¹ 
;
¹¹ 
if
»» 
(
»» 
await
»» (
_categoryProductRepository
»» 0
.
»»0 1
Commit
»»1 7
(
»»7 8
)
»»8 9
)
»»9 :
{
¼¼ 
return
½½ 
await
½½ 
Task
½½ !
.
½½! "

FromResult
½½" ,
(
½½, -
categoryProduct
½½- <
)
½½< =
;
½½= >
}
¾¾ 
NotifyError
ÀÀ 
(
ÀÀ 
$str
ÀÀ /
)
ÀÀ/ 0
;
ÀÀ0 1
return
ÁÁ 
await
ÁÁ 
Task
ÁÁ 
.
ÁÁ 

FromResult
ÁÁ (
<
ÁÁ( )
CategoryProduct
ÁÁ) 8
>
ÁÁ8 9
(
ÁÁ9 :
null
ÁÁ: >
)
ÁÁ> ?
;
ÁÁ? @
}
ÂÂ 	
}
ÃÃ 
}ÄÄ Ó|
YD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\CategoryRestaurantService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class %
CategoryRestaurantService *
:+ ,
BaseService- 8
,8 9&
ICategoryRestaurantService: T
{ 
private 
readonly )
ICategoryRestaurantRepository 6)
_categoryRestaurantRepository7 T
;T U
public %
CategoryRestaurantService (
(( ))
ICategoryRestaurantRepository )(
categoryRestaurantRepository* F
,F G
	INotifier 
notifier 
) 
:  !
base" &
(& '
notifier' /
)/ 0
{ 	)
_categoryRestaurantRepository )
=* +(
categoryRestaurantRepository, H
;H I
} 	
public 
async 
Task 
< 
CategoryRestaurant ,
>, -
Create. 4
(4 5
CategoryRestaurant5 G
categoryRestaurantH Z
)Z [
{ 	
if 
( 
! 
Validate 
( 
new (
CategoryRestaurantValidation :
(: ;
); <
,< =
categoryRestaurant> P
)P Q
)Q R
returnS Y
nullZ ^
;^ _
var  
categoryRestaurantDb $
=% &
await' ,)
_categoryRestaurantRepository- J
.   
Search   
(   
x   
=>   
x   
.   
Name   #
==  $ &
categoryRestaurant  ' 9
.  9 :
Name  : >
)  > ?
;  ? @
if"" 
(""  
categoryRestaurantDb"" $
!=""% '
null""( ,
&&""- / 
categoryRestaurantDb""0 D
.""D E
Any""E H
(""H I
)""I J
)""J K
{## 
NotifyError$$ 
($$ 
$str$$ M
)$$M N
;$$N O
return%% 
await%% 
Task%% !
.%%! "

FromResult%%" ,
<%%, -
CategoryRestaurant%%- ?
>%%? @
(%%@ A
null%%A E
)%%E F
;%%F G
}&& 
await(( )
_categoryRestaurantRepository(( /
.)) 
Add)) 
()) 
categoryRestaurant)) '
)))' (
;))( )
if++ 
(++ 
await++ )
_categoryRestaurantRepository++ 3
.++3 4
Commit++4 :
(++: ;
)++; <
)++< =
{,, 
return-- 
await-- 
Task-- !
.--! "

FromResult--" ,
(--, -
categoryRestaurant--- ?
)--? @
;--@ A
}.. 
NotifyError00 
(00 
$str00 0
)000 1
;001 2
return11 
await11 
Task11 
.11 

FromResult11 (
<11( )
CategoryRestaurant11) ;
>11; <
(11< =
null11= A
)11A B
;11B C
}22 	
public44 
async44 
Task44 
<44 
List44 
<44 
CategoryRestaurant44 1
>441 2
>442 3
GetAll444 :
(44: ;
)44; <
{55 	
return66 
await66 )
_categoryRestaurantRepository66 6
.77 
GetAll77 
(77 
)77 
;77 
}88 	
public:: 
async:: 
Task:: 
<:: 
List:: 
<:: 
CategoryRestaurant:: 1
>::1 2
>::2 3
GetAllWithFilter::4 D
(::D E$
CategoryRestaurantFilter::E ]$
CategoryRestaurantFilter::^ v
)::v w
{;; 	

Expression<< 
<<< 
Func<< 
<<< 
CategoryRestaurant<< .
,<<. /
bool<<0 4
><<4 5
><<5 6
filter<<7 =
=<<> ?
null<<@ D
;<<D E
Func== 
<== 

IQueryable== 
<== 
CategoryRestaurant== .
>==. /
,==/ 0
IOrderedQueryable==1 B
<==B C
CategoryRestaurant==C U
>==U V
>==V W
ordeBy==X ^
===_ `
null==a e
;==e f
if?? 
(?? 
!?? 
string?? 
.?? 
IsNullOrWhiteSpace?? *
(??* +$
CategoryRestaurantFilter??+ C
.??C D
Name??D H
)??H I
)??I J
{@@ 
ifAA 
(AA 
filterAA 
==AA 
nullAA "
)AA" #
{BB 
filterCC 
=CC 
PredicateBuilderCC -
.CC- .
NewCC. 1
<CC1 2
CategoryRestaurantCC2 D
>CCD E
(CCE F
trueCCF J
)CCJ K
;CCK L
}DD 
filterFF 
=FF 
filterFF 
.FF  
AndFF  #
(FF# $
xFF$ %
=>FF& (
xFF) *
.FF* +
NameFF+ /
==FF0 2$
CategoryRestaurantFilterFF3 K
.FFK L
NameFFL P
)FFP Q
;FFQ R
}GG 
ifII 
(II 
!II 
stringII 
.II 
IsNullOrWhiteSpaceII *
(II* +$
CategoryRestaurantFilterII+ C
.IIC D
DescriptionIID O
)IIO P
)IIP Q
{JJ 
ifKK 
(KK 
filterKK 
==KK 
nullKK "
)KK" #
{LL 
filterMM 
=MM 
PredicateBuilderMM -
.MM- .
NewMM. 1
<MM1 2
CategoryRestaurantMM2 D
>MMD E
(MME F
trueMMF J
)MMJ K
;MMK L
}NN 
filterPP 
=PP 
filterPP 
.PP  
AndPP  #
(PP# $
xPP$ %
=>PP& (
xPP) *
.PP* +
DescriptionPP+ 6
==PP7 9$
CategoryRestaurantFilterPP: R
.PPR S
DescriptionPPS ^
)PP^ _
;PP_ `
}QQ 
ifSS 
(SS 
!SS 
stringSS 
.SS 
IsNullOrWhiteSpaceSS *
(SS* +$
CategoryRestaurantFilterSS+ C
.SSC D
OrderSSD I
)SSI J
)SSJ K
{TT 
switchUU 
(UU $
CategoryRestaurantFilterUU 0
.UU0 1
OrderUU1 6
)UU6 7
{VV 
caseWW 
$strWW 
:WW 
ordeByXX 
=XX  
xXX! "
=>XX# %
xXX& '
.XX' (
OrderByXX( /
(XX/ 0
nXX0 1
=>XX2 4
nXX5 6
.XX6 7
IdXX7 9
)XX9 :
;XX: ;
breakYY 
;YY 
caseZZ 
$strZZ 
:ZZ  
ordeBy[[ 
=[[  
x[[! "
=>[[# %
x[[& '
.[[' (
OrderBy[[( /
([[/ 0
n[[0 1
=>[[2 4
n[[5 6
.[[6 7
Name[[7 ;
)[[; <
;[[< =
break\\ 
;\\ 
case]] 
$str]] &
:]]& '
ordeBy^^ 
=^^  
x^^! "
=>^^# %
x^^& '
.^^' (
OrderBy^^( /
(^^/ 0
n^^0 1
=>^^2 4
n^^5 6
.^^6 7
Description^^7 B
)^^B C
;^^C D
break__ 
;__ 
case`` 
$str`` $
:``$ %
ordeByaa 
=aa  
xaa! "
=>aa# %
xaa& '
.aa' (
OrderByaa( /
(aa/ 0
naa0 1
=>aa2 4
naa5 6
.aa6 7
	CreatedAtaa7 @
)aa@ A
;aaA B
breakbb 
;bb 
}cc 
}dd 
ifff 
(ff $
CategoryRestaurantFilterff (
.ff( )
Idff) +
!=ff, .
Guidff/ 3
.ff3 4
Emptyff4 9
)ff9 :
{gg 
ifhh 
(hh 
filterhh 
==hh 
nullhh "
)hh" #
{ii 
filterjj 
=jj 
PredicateBuilderjj -
.jj- .
Newjj. 1
<jj1 2
CategoryRestaurantjj2 D
>jjD E
(jjE F
truejjF J
)jjJ K
;jjK L
}kk 
filtermm 
=mm 
filtermm 
.mm  
Andmm  #
(mm# $
xmm$ %
=>mm& (
xmm) *
.mm* +
Idmm+ -
==mm. 0$
CategoryRestaurantFiltermm1 I
.mmI J
IdmmJ L
)mmL M
;mmM N
}nn 
ifpp 
(pp $
CategoryRestaurantFilterpp (
.pp( )
	CreatedAtpp) 2
.pp2 3
Yearpp3 7
>pp8 9
$numpp: ;
)pp; <
{qq 
ifrr 
(rr 
filterrr 
==rr 
nullrr "
)rr" #
{ss 
filtertt 
=tt 
PredicateBuildertt -
.tt- .
Newtt. 1
<tt1 2
CategoryRestauranttt2 D
>ttD E
(ttE F
truettF J
)ttJ K
;ttK L
}uu 
filterww 
=ww 
filterww 
.ww  
Andww  #
(ww# $
xww$ %
=>ww& (
xww) *
.ww* +
Idww+ -
==ww. 0$
CategoryRestaurantFilterww1 I
.wwI J
IdwwJ L
)wwL M
;wwM N
}xx 
returnzz 
awaitzz )
_categoryRestaurantRepositoryzz 6
.{{ 
Search{{ 
({{ 
filter|| 
,|| 
ordeBy}} 
,}} $
CategoryRestaurantFilter~~ ,
.~~, -
PageSize~~- 5
,~~5 6$
CategoryRestaurantFilter ,
., -
	PageIndex- 6
)6 7
;7 8
}
€€ 	
public
‚‚ 
async
‚‚ 
Task
‚‚ 
<
‚‚  
CategoryRestaurant
‚‚ ,
>
‚‚, -
GetById
‚‚. 5
(
‚‚5 6
Guid
‚‚6 :
id
‚‚; =
)
‚‚= >
{
ƒƒ 	
return
„„ 
await
„„ +
_categoryRestaurantRepository
„„ 6
.
…… 
GetById
…… 
(
…… 
id
…… 
)
…… 
;
…… 
}
†† 	
public
ˆˆ 
async
ˆˆ 
Task
ˆˆ 
<
ˆˆ  
CategoryRestaurant
ˆˆ ,
>
ˆˆ, -
Update
ˆˆ. 4
(
ˆˆ4 5 
CategoryRestaurant
ˆˆ5 G 
categoryRestaurant
ˆˆH Z
)
ˆˆZ [
{
‰‰ 	
if
ŠŠ 
(
ŠŠ 
!
ŠŠ 
Validate
ŠŠ 
(
ŠŠ 
new
ŠŠ *
CategoryRestaurantValidation
ŠŠ :
(
ŠŠ: ;
)
ŠŠ; <
,
ŠŠ< = 
categoryRestaurant
ŠŠ> P
)
ŠŠP Q
)
ŠŠQ R
return
ŠŠS Y
null
ŠŠZ ^
;
ŠŠ^ _
var
ŒŒ "
categoryRestaurantDb
ŒŒ $
=
ŒŒ% &
await
ŒŒ' ,+
_categoryRestaurantRepository
ŒŒ- J
.
 
GetById
 
(
  
categoryRestaurant
 +
.
+ ,
Id
, .
)
. /
;
/ 0
if
 
(
 "
categoryRestaurantDb
 $
==
% '
null
( ,
)
, -
{
 
NotifyError
‘‘ 
(
‘‘ 
$str
‘‘ '
)
‘‘' (
;
‘‘( )
return
’’ 
await
’’ 
Task
’’ !
.
’’! "

FromResult
’’" ,
<
’’, - 
CategoryRestaurant
’’- ?
>
’’? @
(
’’@ A
null
’’A E
)
’’E F
;
’’F G
}
““ 
if
•• 
(
•• "
categoryRestaurantDb
•• #
.
••# $
Name
••$ (
!=
••) + 
categoryRestaurant
••, >
.
••> ?
Name
••? C
)
••C D
{
–– "
categoryRestaurantDb
—— $
.
——$ %
Name
——% )
=
——* + 
categoryRestaurant
——, >
.
——> ?
Name
——? C
;
——C D
}
˜˜ 
if
šš 
(
šš "
categoryRestaurantDb
šš $
.
šš$ %
Description
šš% 0
!=
šš1 3 
categoryRestaurant
šš4 F
.
ššF G
Description
ššG R
)
ššR S
{
›› "
categoryRestaurantDb
œœ $
.
œœ$ %
Description
œœ% 0
=
œœ1 2 
categoryRestaurant
œœ3 E
.
œœE F
Description
œœF Q
;
œœQ R
}
 +
_categoryRestaurantRepository
ŸŸ )
.
   
Update
   
(
   "
categoryRestaurantDb
   ,
)
  , -
;
  - .
if
¢¢ 
(
¢¢ 
await
¢¢ +
_categoryRestaurantRepository
¢¢ 3
.
¢¢3 4
Commit
¢¢4 :
(
¢¢: ;
)
¢¢; <
)
¢¢< =
{
££ 
return
¤¤ 
await
¤¤ 
Task
¤¤ !
.
¤¤! "

FromResult
¤¤" ,
(
¤¤, -"
categoryRestaurantDb
¤¤- A
)
¤¤A B
;
¤¤B C
}
¥¥ 
NotifyError
§§ 
(
§§ 
$str
§§ /
)
§§/ 0
;
§§0 1
return
¨¨ 
await
¨¨ 
Task
¨¨ 
.
¨¨ 

FromResult
¨¨ (
<
¨¨( ) 
CategoryRestaurant
¨¨) ;
>
¨¨; <
(
¨¨< =
null
¨¨= A
)
¨¨A B
;
¨¨B C
}
©© 	
public
«« 
async
«« 
Task
«« 
<
««  
CategoryRestaurant
«« ,
>
««, -
Delete
««. 4
(
««4 5
Guid
««5 9
id
««: <
)
««< =
{
¬¬ 	
var
­­ "
categoryRestaurantDb
­­ $
=
­­% &
await
­­' ,+
_categoryRestaurantRepository
­­- J
.
®® 
GetById
®® 
(
®® 
id
®® 
)
®® 
;
®® 
if
°° 
(
°° "
categoryRestaurantDb
°° $
==
°°% '
null
°°( ,
)
°°, -
{
±± 
NotifyError
²² 
(
²² 
$str
²² '
)
²²' (
;
²²( )
return
³³ 
await
³³ 
Task
³³ !
.
³³! "

FromResult
³³" ,
<
³³, - 
CategoryRestaurant
³³- ?
>
³³? @
(
³³@ A
null
³³A E
)
³³E F
;
³³F G
}
´´ +
_categoryRestaurantRepository
¶¶ )
.
·· 
Remove
·· 
(
·· 
id
·· 
)
·· 
;
·· 
if
¹¹ 
(
¹¹ 
await
¹¹ +
_categoryRestaurantRepository
¹¹ 3
.
¹¹3 4
Commit
¹¹4 :
(
¹¹: ;
)
¹¹; <
)
¹¹< =
{
ºº 
return
»» 
await
»» 
Task
»» !
.
»»! "

FromResult
»»" ,
(
»», -"
categoryRestaurantDb
»»- A
)
»»A B
;
»»B C
}
¼¼ 
NotifyError
¾¾ 
(
¾¾ 
$str
¾¾ /
)
¾¾/ 0
;
¾¾0 1
return
¿¿ 
await
¿¿ 
Task
¿¿ 
.
¿¿ 

FromResult
¿¿ (
<
¿¿( ) 
CategoryRestaurant
¿¿) ;
>
¿¿; <
(
¿¿< =
null
¿¿= A
)
¿¿A B
;
¿¿B C
}
ÀÀ 	
}
ÁÁ 
}ÂÂ D
ND:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\CommentService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class 
CommentService 
:  !
BaseService" -
,- .
ICommentService/ >
{ 
private 
readonly !
IRestaurantRepository .!
_restaurantRepository/ D
;D E
private 
readonly 
ICommentRepository +
_commentRepository, >
;> ?
public 
CommentService 
( !
IRestaurantRepository ! 
restaurantRepository" 6
,6 7
ICommentRepository 
commentRepository 0
,0 1
	INotifier 
notifier 
) 
:  !
base" &
(& '
notifier' /
)/ 0
{ 	!
_restaurantRepository !
=" # 
restaurantRepository$ 8
;8 9
_commentRepository 
=  
commentRepository! 2
;2 3
} 	
public 
async 
Task 
< 
Comment !
>! "
Create# )
() *
Guid* .
idRestaurant/ ;
,; <
Comment= D
commentE L
)L M
{ 	
if 
( 
! 
Validate 
( 
new 
CommentValidation /
(/ 0
)0 1
,1 2
comment3 :
): ;
); <
return= C
nullD H
;H I
var 
restaurantBD 
= 
await $!
_restaurantRepository% :
.   
GetById   
(   
idRestaurant   %
)  % &
;  & '
if"" 
("" 
restaurantBD"" 
=="" 
null""  $
)""$ %
{## 
NotifyError$$ 
($$ 
$str$$ 4
)$$4 5
;$$5 6
return%% 
await%% 
Task%% !
.%%! "

FromResult%%" ,
<%%, -
Comment%%- 4
>%%4 5
(%%5 6
null%%6 :
)%%: ;
;%%; <
}&& 
await(( 
_commentRepository(( $
.)) 
Add)) 
()) 
comment)) 
))) 
;)) 
if++ 
(++ 
await++ 
_commentRepository++ (
.++( )
Commit++) /
(++/ 0
)++0 1
)++1 2
{,, 
return-- 
await-- 
Task-- !
.--! "

FromResult--" ,
(--, -
comment--- 4
)--4 5
;--5 6
}.. 
NotifyError00 
(00 
$str00 0
)000 1
;001 2
return11 
await11 
Task11 
.11 

FromResult11 (
<11( )
Comment11) 0
>110 1
(111 2
null112 6
)116 7
;117 8
}22 	
public44 
async44 
Task44 
<44 
Comment44 !
>44! "
GetById44# *
(44* +
Guid44+ /
idRestaurant440 <
,44< =
Guid44> B
	idComment44C L
)44L M
{55 	
return66 
await66 
_commentRepository66 +
.77 
GetById77 
(77 
idRestaurant77 %
,77% &
	idComment77' 0
)770 1
;771 2
}88 	
public:: 
async:: 
Task:: 
<:: 
List:: 
<:: 
Comment:: &
>::& '
>::' (
GetAll::) /
(::/ 0
Guid::0 4
idRestaurant::5 A
)::A B
{;; 	
return<< 
await<< 
_commentRepository<< +
.== 
GetAll== 
(== 
idRestaurant== $
)==$ %
;==% &
}>> 	
public@@ 
async@@ 
Task@@ 
<@@ 
Comment@@ !
>@@! "
Update@@# )
(@@) *
Guid@@* .
idRestaurant@@/ ;
,@@; <
Guid@@= A
	idComment@@B K
,@@K L
Comment@@M T
comment@@U \
)@@\ ]
{AA 	
ifBB 
(BB 
!BB 
ValidateBB 
(BB 
newBB 
CommentValidationBB /
(BB/ 0
)BB0 1
,BB1 2
commentBB3 :
)BB: ;
)BB; <
returnBB= C
nullBBD H
;BBH I
varDD 
	commentDbDD 
=DD 
awaitDD !
_commentRepositoryDD" 4
.EE 
GetByIdEE 
(EE 
idRestaurantEE %
,EE% &
	idCommentEE' 0
)EE0 1
;EE1 2
ifGG 
(GG 
	commentDbGG 
==GG 
nullGG !
)GG! "
{HH 
NotifyErrorII 
(II 
$strII '
)II' (
;II( )
returnJJ 
awaitJJ 
TaskJJ !
.JJ! "

FromResultJJ" ,
<JJ, -
CommentJJ- 4
>JJ4 5
(JJ5 6
nullJJ6 :
)JJ: ;
;JJ; <
}KK 
ifMM 
(MM 
	commentDbMM 
.MM 
StartsMM  
!=MM! #
commentMM$ +
.MM+ ,
StartsMM, 2
)MM2 3
{NN 
	commentDbOO 
.OO 
StartsOO  
=OO! "
commentOO# *
.OO* +
StartsOO+ 1
;OO1 2
}PP 
ifRR 
(RR 
	commentDbRR 
.RR 
TextRR 
!=RR !
commentRR" )
.RR) *
TextRR* .
)RR. /
{SS 
	commentDbTT 
.TT 
TextTT 
=TT  
commentTT! (
.TT( )
TextTT) -
;TT- .
}UU 
_commentRepositoryXX 
.YY 
UpdateYY 
(YY 
	commentDbYY !
)YY! "
;YY" #
if[[ 
([[ 
await[[ 
_commentRepository[[ (
.[[( )
Commit[[) /
([[/ 0
)[[0 1
)[[1 2
{\\ 
return]] 
await]] 
Task]] !
.]]! "

FromResult]]" ,
(]], -
	commentDb]]- 6
)]]6 7
;]]7 8
}^^ 
NotifyError`` 
(`` 
$str`` /
)``/ 0
;``0 1
returnaa 
awaitaa 
Taskaa 
.aa 

FromResultaa (
<aa( )
Commentaa) 0
>aa0 1
(aa1 2
nullaa2 6
)aa6 7
;aa7 8
}bb 	
publicdd 
asyncdd 
Taskdd 
<dd 
Commentdd !
>dd! "
Deletedd# )
(dd) *
Guiddd* .
idRestaurantdd/ ;
,dd; <
Guiddd= A
	idCommentddB K
)ddK L
{ee 	
varff 
commentff 
=ff 
awaitff 
_commentRepositoryff  2
.gg 
GetByIdgg 
(gg 
idRestaurantgg %
,gg% &
	idCommentgg' 0
)gg0 1
;gg1 2
ifii 
(ii 
commentii 
==ii 
nullii 
)ii  
{jj 
NotifyErrorkk 
(kk 
$strkk '
)kk' (
;kk( )
returnll 
awaitll 
Taskll !
.ll! "

FromResultll" ,
<ll, -
Commentll- 4
>ll4 5
(ll5 6
nullll6 :
)ll: ;
;ll; <
}mm 
_commentRepositoryoo 
.pp 
Removepp 
(pp 
	idCommentpp !
)pp! "
;pp" #
ifrr 
(rr 
awaitrr 
_commentRepositoryrr (
.rr( )
Commitrr) /
(rr/ 0
)rr0 1
)rr1 2
{ss 
returntt 
awaittt 
Tasktt !
.tt! "

FromResulttt" ,
(tt, -
commenttt- 4
)tt4 5
;tt5 6
}uu 
NotifyErrorww 
(ww 
$strww /
)ww/ 0
;ww0 1
returnxx 
awaitxx 
Taskxx 
.xx 

FromResultxx (
<xx( )
Commentxx) 0
>xx0 1
(xx1 2
nullxx2 6
)xx6 7
;xx7 8
}yy 	
}zz 
}{{ †H
MD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\CouponService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class 
CouponService 
:  
BaseService! ,
,, -
ICouponService. <
{ 
private 
readonly 
ICouponRepository *
_couponRepository+ <
;< =
public 
CouponService 
( 
ICouponRepository 
couponRepository .
,. /
	INotifier 
notifier 
) 
:  !
base" &
(& '
notifier' /
)/ 0
{ 	
_couponRepository 
= 
couponRepository  0
;0 1
} 	
public 
async 
Task 
< 
Coupon  
>  !
Create" (
(( )
Coupon) /
coupon0 6
)6 7
{ 	
if 
( 
! 
Validate 
( 
new 
CouponValidation .
(. /
)/ 0
,0 1
coupon2 8
)8 9
)9 :
return; A
nullB F
;F G
var 
coupons 
= 
await 
_couponRepository  1
. 
Search 
( 
x 
=> 
x 
. 
Code #
==$ &
coupon' -
.- .
Code. 2
&&3 5
x6 7
.7 8
ExpireAt8 @
<A B
DateTimeC K
.K L
NowL O
)O P
;P Q
if   
(   
coupons   
!=   
null   
&&    "
coupons  # *
.  * +
Any  + .
(  . /
)  / 0
)  0 1
{!! 
NotifyError"" 
("" 
$str"" L
)""L M
;""M N
return## 
await## 
Task## !
.##! "

FromResult##" ,
<##, -
Coupon##- 3
>##3 4
(##4 5
null##5 9
)##9 :
;##: ;
}$$ 
await&& 
_couponRepository&& #
.'' 
Add'' 
('' 
coupon'' 
)'' 
;'' 
if)) 
()) 
await)) 
_couponRepository)) '
.))' (
Commit))( .
()). /
)))/ 0
)))0 1
{** 
return++ 
await++ 
Task++ !
.++! "

FromResult++" ,
(++, -
coupon++- 3
)++3 4
;++4 5
},, 
NotifyError.. 
(.. 
$str.. 0
)..0 1
;..1 2
return// 
await// 
Task// 
.// 

FromResult// (
<//( )
Coupon//) /
>/// 0
(//0 1
null//1 5
)//5 6
;//6 7
}00 	
public22 
async22 
Task22 
<22 
List22 
<22 
Coupon22 %
>22% &
>22& '
GetAll22( .
(22. /
bool22/ 3
ative224 9
=22: ;
true22< @
)22@ A
{33 	
if44 
(44 
ative44 
)44 
{55 
return66 
(66 
List66 
<66 
Coupon66 #
>66# $
)66$ %
await66& +
_couponRepository66, =
.77 
Find77 
(77 
x77 
=>77 
x77 
.77 
ExpireAt77 %
>77& '
DateTime77( 0
.770 1
Now771 4
)774 5
;775 6
}88 
return:: 
await:: 
_couponRepository:: *
.;; 
GetAll;; 
(;; 
);; 
;;; 
}<< 	
public>> 
async>> 
Task>> 
<>> 
Coupon>>  
>>>  !
GetById>>" )
(>>) *
Guid>>* .
id>>/ 1
)>>1 2
{?? 	
return@@ 
await@@ 
_couponRepository@@ *
.AA 
GetByIdAA 
(AA 
idAA 
)AA 
;AA 
}BB 	
publicDD 
asyncDD 
TaskDD 
<DD 
CouponDD  
>DD  !
UpdateDD" (
(DD( )
CouponDD) /
couponDD0 6
)DD6 7
{EE 	
ifFF 
(FF 
!FF 
ValidateFF 
(FF 
newFF 
CouponValidationFF .
(FF. /
)FF/ 0
,FF0 1
couponFF2 8
)FF8 9
)FF9 :
returnFF; A
nullFFB F
;FFF G
varHH 
couponDbHH 
=HH 
awaitHH  
_couponRepositoryHH! 2
.II 
GetByIdII 
(II 
couponII 
.II  
IdII  "
)II" #
;II# $
ifKK 
(KK 
couponDbKK 
==KK 
nullKK  
)KK  !
{LL 
NotifyErrorMM 
(MM 
$strMM '
)MM' (
;MM( )
returnNN 
awaitNN 
TaskNN !
.NN! "

FromResultNN" ,
<NN, -
CouponNN- 3
>NN3 4
(NN4 5
nullNN5 9
)NN9 :
;NN: ;
}OO 
ifQQ 
(QQ 
couponDbQQ 
.QQ 
CodeQQ 
!=QQ  
couponDbQQ! )
.QQ) *
CodeQQ* .
)QQ. /
{RR 
couponDbSS 
.SS 
CodeSS 
=SS 
couponDbSS  (
.SS( )
CodeSS) -
;SS- .
}TT 
ifVV 
(VV 
couponDbVV 
.VV 
ExpireAtVV !
!=VV" $
couponDbVV% -
.VV- .
ExpireAtVV. 6
)VV6 7
{WW 
couponDbXX 
.XX 
ExpireAtXX !
=XX" #
couponDbXX$ ,
.XX, -
ExpireAtXX- 5
;XX5 6
}YY 
if[[ 
([[ 
couponDb[[ 
.[[ 
Value[[ 
!=[[ !
couponDb[[" *
.[[* +
Value[[+ 0
)[[0 1
{\\ 
couponDb]] 
.]] 
Value]] 
=]]  
couponDb]]! )
.]]) *
Value]]* /
;]]/ 0
}^^ 
_couponRepository`` 
.aa 
Updateaa 
(aa 
couponDbaa !
)aa! "
;aa" #
ifcc 
(cc 
awaitcc 
_couponRepositorycc '
.cc' (
Commitcc( .
(cc. /
)cc/ 0
)cc0 1
{dd 
returnee 
awaitee 
Taskee !
.ee! "

FromResultee" ,
<ee, -
Couponee- 3
>ee3 4
(ee4 5
couponDbee5 =
)ee= >
;ee> ?
}ff 
NotifyErrorhh 
(hh 
$strhh /
)hh/ 0
;hh0 1
returnii 
awaitii 
Taskii 
.ii 

FromResultii (
<ii( )
Couponii) /
>ii/ 0
(ii0 1
nullii1 5
)ii5 6
;ii6 7
}jj 	
publicll 
asyncll 
Taskll 
<ll 
Couponll  
>ll  !
Deletell" (
(ll( )
Guidll) -
idll. 0
)ll0 1
{mm 	
varnn 
couponnn 
=nn 
awaitnn 
_couponRepositorynn 0
.oo 
GetByIdoo 
(oo 
idoo 
)oo 
;oo 
ifqq 
(qq 
couponqq 
==qq 
nullqq 
)qq 
{rr 
NotifyErrorss 
(ss 
$strss '
)ss' (
;ss( )
returntt 
awaittt 
Tasktt !
.tt! "

FromResulttt" ,
<tt, -
Coupontt- 3
>tt3 4
(tt4 5
nulltt5 9
)tt9 :
;tt: ;
}uu 
_couponRepositoryww 
.xx 
Removexx 
(xx 
idxx 
)xx 
;xx 
ifzz 
(zz 
awaitzz 
_couponRepositoryzz '
.zz' (
Commitzz( .
(zz. /
)zz/ 0
)zz0 1
{{{ 
return|| 
await|| 
Task|| !
.||! "

FromResult||" ,
(||, -
coupon||- 3
)||3 4
;||4 5
}}} 
NotifyError 
( 
$str /
)/ 0
;0 1
return
€€ 
await
€€ 
Task
€€ 
.
€€ 

FromResult
€€ (
<
€€( )
Coupon
€€) /
>
€€/ 0
(
€€0 1
null
€€1 5
)
€€5 6
;
€€6 7
}
 	
}
‚‚ 
}ƒƒ ¼
KD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\ItemService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class 
ItemService 
: 
IItemService +
{		 
}

 
} ú
LD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\OrderService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class 
OrderService 
: 
BaseService  +
,+ ,
IOrderService- :
{ 
private 
readonly 
IOrderRepository )
_orderRepository* :
;: ;
public 
OrderService 
( 
IOrderRepository 
orderRepository ,
,, -
	INotifier 
notifier 
) 
:  !
base 
( 
notifier 
) 
{ 	
_orderRepository 
= 
orderRepository .
;. /
} 	
public 
Task 
< 
Order 
> 
Create !
(! "
Order" '
order( -
)- .
{ 	
throw 
new #
NotImplementedException -
(- .
). /
;/ 0
} 	
public 
Task 
< 
Order 
> 
Delete !
(! "
Guid" &
id' )
)) *
{ 	
throw   
new   #
NotImplementedException   -
(  - .
)  . /
;  / 0
}!! 	
public## 
Task## 
<## 
List## 
<## 
Order## 
>## 
>##  
GetAllWithFilter##! 1
(##1 2
OrderFilter##2 =
orderFilter##> I
)##I J
{$$ 	
throw%% 
new%% #
NotImplementedException%% -
(%%- .
)%%. /
;%%/ 0
}&& 	
public(( 
Task(( 
<(( 
Order(( 
>(( 
GetById(( "
(((" #
Guid((# '
id((( *
)((* +
{)) 	
throw** 
new** #
NotImplementedException** -
(**- .
)**. /
;**/ 0
}++ 	
public-- 
Task-- 
<-- 
Order-- 
>-- 
Update-- !
(--! "
Order--" '
order--( -
)--- .
{.. 	
throw// 
new// #
NotImplementedException// -
(//- .
)//. /
;/// 0
}00 	
}11 
}22 Â
RD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\OrderStatusService.cs
	namespace

 	
IHunger


 
.

 
Service

 
{ 
public 

class 
OrderStatusService #
:$ %
BaseService& 1
,1 2
IOrderStatusService3 F
{ 
private 
readonly "
IOrderStatusRepository /"
_orderStatusRepository0 F
;F G
public 
OrderStatusService !
(! ""
IOrderStatusRepository "!
orderStatusRepository# 8
,8 9
	INotifier 
notifier 
) 
:  !
base" &
(& '
notifier' /
)/ 0
{ 	"
_orderStatusRepository "
=# $!
orderStatusRepository% :
;: ;
} 	
public 
async 
Task 
< 
List 
< 
OrderStatus *
>* +
>+ ,
GetAll- 3
(3 4
)4 5
{ 	
return 
await "
_orderStatusRepository /
. 
GetAll 
( 
) 
; 
} 	
public 
async 
Task 
< 
OrderStatus %
>% &
GetById' .
(. /
Guid/ 3
id4 6
)6 7
{ 	
return 
await "
_orderStatusRepository /
.   
GetById   
(   
id   
)   
;   
}!! 	
}## 
}$$ ¾Î
ND:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\ProductService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class 
ProductService 
:  !
BaseService" -
,- .
IProductService/ >
{ 
private 
readonly !
IRestaurantRepository .!
_restaurantRepository/ D
;D E
private 
readonly 
IProductRepository +
_productRepository, >
;> ?
private 
readonly &
ICategoryProductRepository 3&
_categoryProductRepository4 N
;N O
public 
ProductService 
( !
IRestaurantRepository ! 
restaurantRepository" 6
,6 7
IProductRepository 
productRepository 0
,0 1&
ICategoryProductRepository &%
categoryProductRepository' @
,@ A
	INotifier 
notifier 
) 
:  !
base" &
(& '
notifier' /
)/ 0
{ 	!
_restaurantRepository !
=" # 
restaurantRepository$ 8
;8 9
_productRepository 
=  
productRepository! 2
;2 3&
_categoryProductRepository &
=' (%
categoryProductRepository) B
;B C
}   	
public"" 
async"" 
Task"" 
<"" 
Product"" !
>""! "
Create""# )
("") *
Product""* 1
product""2 9
)""9 :
{## 	
if$$ 
($$ 
!$$ 
Validate$$ 
($$ 
new$$ 
ProductValidation$$ /
($$/ 0
)$$0 1
,$$1 2
product$$3 :
)$$: ;
)$$; <
return$$= C
null$$D H
;$$H I
var&& 

restaurant&& 
=&& 
await&& "!
_restaurantRepository&&# 8
.'' 
GetById'' 
('' 
product''  
.''  !
IdRestaurant''! -
)''- .
;''. /
if)) 
()) 

restaurant)) 
==)) 
null)) "
)))" #
{** 
NotifyError++ 
(++ 
$str++ 3
)++3 4
;++4 5
return,, 
await,, 
Task,, !
.,,! "

FromResult,," ,
<,,, -
Product,,- 4
>,,4 5
(,,5 6
null,,6 :
),,: ;
;,,; <
}-- 
var// 
categoryProduct// 
=//  !
await//" '&
_categoryProductRepository//( B
.00 
GetById00 
(00 
product00  
.00  !
IdCategoryProduct00! 2
)002 3
;003 4
if22 
(22 
categoryProduct22 
==22  "
null22# '
)22' (
{33 
NotifyError44 
(44 
$str44 8
)448 9
;449 :
return55 
await55 
Task55 !
.55! "

FromResult55" ,
<55, -
Product55- 4
>554 5
(555 6
null556 :
)55: ;
;55; <
}66 
await88 
_productRepository88 $
.99 
Add99 
(99 
product99 
)99 
;99 
if;; 
(;; 
await;; 
_productRepository;; (
.;;( )
Commit;;) /
(;;/ 0
);;0 1
);;1 2
{<< 
return== 
await== 
Task== !
.==! "

FromResult==" ,
(==, -
product==- 4
)==4 5
;==5 6
}>> 
NotifyError@@ 
(@@ 
$str@@ 0
)@@0 1
;@@1 2
returnAA 
awaitAA 
TaskAA 
.AA 

FromResultAA (
<AA( )
ProductAA) 0
>AA0 1
(AA1 2
nullAA2 6
)AA6 7
;AA7 8
}BB 	
publicDD 
asyncDD 
TaskDD 
<DD 
ListDD 
<DD 
ProductDD &
>DD& '
>DD' (
GetAllWithFilterDD) 9
(DD9 :
ProductFilterDD: G
productFilterDDH U
)DDU V
{EE 	

ExpressionFF 
<FF 
FuncFF 
<FF 
ProductFF #
,FF# $
boolFF% )
>FF) *
>FF* +
filterFF, 2
=FF3 4
nullFF5 9
;FF9 :
FuncGG 
<GG 

IQueryableGG 
<GG 
ProductGG #
>GG# $
,GG$ %
IOrderedQueryableGG& 7
<GG7 8
ProductGG8 ?
>GG? @
>GG@ A
ordeByGGB H
=GGI J
nullGGK O
;GGO P
ifII 
(II 
!II 
stringII 
.II 
IsNullOrWhiteSpaceII *
(II* +
productFilterII+ 8
.II8 9
NameII9 =
)II= >
)II> ?
{JJ 
ifKK 
(KK 
filterKK 
==KK 
nullKK "
)KK" #
{LL 
filterMM 
=MM 
PredicateBuilderMM -
.MM- .
NewMM. 1
<MM1 2
ProductMM2 9
>MM9 :
(MM: ;
trueMM; ?
)MM? @
;MM@ A
}NN 
filterPP 
=PP 
filterPP 
.PP  
AndPP  #
(PP# $
xPP$ %
=>PP& (
xPP) *
.PP* +
NamePP+ /
==PP0 2
productFilterPP3 @
.PP@ A
NamePPA E
)PPE F
;PPF G
}QQ 
ifSS 
(SS 
productFilterSS 
.SS 
IdSS  
!=SS! #
GuidSS$ (
.SS( )
EmptySS) .
)SS. /
{TT 
ifUU 
(UU 
filterUU 
==UU 
nullUU "
)UU" #
{VV 
filterWW 
=WW 
PredicateBuilderWW -
.WW- .
NewWW. 1
<WW1 2
ProductWW2 9
>WW9 :
(WW: ;
trueWW; ?
)WW? @
;WW@ A
}XX 
filterZZ 
=ZZ 
filterZZ 
.ZZ  
AndZZ  #
(ZZ# $
xZZ$ %
=>ZZ& (
xZZ) *
.ZZ* +
IdZZ+ -
==ZZ. 0
productFilterZZ1 >
.ZZ> ?
IdZZ? A
)ZZA B
;ZZB C
}[[ 
if]] 
(]] 
productFilter]] 
.]] 
IdCategoryProduct]] /
!=]]0 2
Guid]]3 7
.]]7 8
Empty]]8 =
)]]= >
{^^ 
if__ 
(__ 
filter__ 
==__ 
null__ "
)__" #
{`` 
filteraa 
=aa 
PredicateBuilderaa -
.aa- .
Newaa. 1
<aa1 2
Productaa2 9
>aa9 :
(aa: ;
trueaa; ?
)aa? @
;aa@ A
}bb 
filterdd 
=dd 
filterdd 
.dd  
Anddd  #
(dd# $
xdd$ %
=>dd& (
xdd) *
.dd* +
CategoryProductdd+ :
.dd: ;
Iddd; =
==dd> @
productFilterddA N
.ddN O
IdCategoryProductddO `
)dd` a
;dda b
}ee 
ifgg 
(gg 
!gg 
stringgg 
.gg 
IsNullOrWhiteSpacegg *
(gg* +
productFiltergg+ 8
.gg8 9
Descriptiongg9 D
)ggD E
)ggE F
{hh 
ifii 
(ii 
filterii 
==ii 
nullii "
)ii" #
{jj 
filterkk 
=kk 
PredicateBuilderkk -
.kk- .
Newkk. 1
<kk1 2
Productkk2 9
>kk9 :
(kk: ;
truekk; ?
)kk? @
;kk@ A
}ll 
filternn 
=nn 
filternn 
.nn  
Andnn  #
(nn# $
xnn$ %
=>nn& (
xnn) *
.nn* +
Descriptionnn+ 6
==nn7 9
productFilternn: G
.nnG H
DescriptionnnH S
)nnS T
;nnT U
}oo 
ifqq 
(qq 
productFilterqq 
.qq 
Kosherqq $
)qq$ %
{rr 
ifss 
(ss 
filterss 
==ss 
nullss "
)ss" #
{tt 
filteruu 
=uu 
PredicateBuilderuu -
.uu- .
Newuu. 1
<uu1 2
Productuu2 9
>uu9 :
(uu: ;
trueuu; ?
)uu? @
;uu@ A
}vv 
filterxx 
=xx 
filterxx 
.xx  
Andxx  #
(xx# $
xxx$ %
=>xx& (
xxx) *
.xx* +
Kosherxx+ 1
==xx2 4
productFilterxx5 B
.xxB C
KosherxxC I
)xxI J
;xxJ K
}yy 
if{{ 
({{ 
productFilter{{ 
.{{ 
Vegan{{ #
){{# $
{|| 
if}} 
(}} 
filter}} 
==}} 
null}} "
)}}" #
{~~ 
filter 
= 
PredicateBuilder -
.- .
New. 1
<1 2
Product2 9
>9 :
(: ;
true; ?
)? @
;@ A
}
€€ 
filter
‚‚ 
=
‚‚ 
filter
‚‚ 
.
‚‚  
And
‚‚  #
(
‚‚# $
x
‚‚$ %
=>
‚‚& (
x
‚‚) *
.
‚‚* +
Vegan
‚‚+ 0
==
‚‚1 3
productFilter
‚‚4 A
.
‚‚A B
Vegan
‚‚B G
)
‚‚G H
;
‚‚H I
}
ƒƒ 
if
…… 
(
…… 
productFilter
…… 
.
…… 

Vegetarian
…… (
)
……( )
{
†† 
if
‡‡ 
(
‡‡ 
filter
‡‡ 
==
‡‡ 
null
‡‡ "
)
‡‡" #
{
ˆˆ 
filter
‰‰ 
=
‰‰ 
PredicateBuilder
‰‰ -
.
‰‰- .
New
‰‰. 1
<
‰‰1 2
Product
‰‰2 9
>
‰‰9 :
(
‰‰: ;
true
‰‰; ?
)
‰‰? @
;
‰‰@ A
}
ŠŠ 
filter
ŒŒ 
=
ŒŒ 
filter
ŒŒ 
.
ŒŒ  
And
ŒŒ  #
(
ŒŒ# $
x
ŒŒ$ %
=>
ŒŒ& (
x
ŒŒ) *
.
ŒŒ* +

Vegetarian
ŒŒ+ 5
==
ŒŒ6 8
productFilter
ŒŒ9 F
.
ŒŒF G

Vegetarian
ŒŒG Q
)
ŒŒQ R
;
ŒŒR S
}
 
if
 
(
 
!
 
string
 
.
  
IsNullOrWhiteSpace
 *
(
* +
productFilter
+ 8
.
8 9!
NameCategoryProduct
9 L
)
L M
)
M N
{
 
if
‘‘ 
(
‘‘ 
filter
‘‘ 
==
‘‘ 
null
‘‘ "
)
‘‘" #
{
’’ 
filter
““ 
=
““ 
PredicateBuilder
““ -
.
““- .
New
““. 1
<
““1 2
Product
““2 9
>
““9 :
(
““: ;
true
““; ?
)
““? @
;
““@ A
}
”” 
filter
–– 
=
–– 
filter
–– 
.
––  
And
––  #
(
––# $
x
––$ %
=>
––& (
x
––) *
.
––* +
CategoryProduct
––+ :
.
––: ;
Name
––; ?
==
––@ B
productFilter
––C P
.
––P Q!
NameCategoryProduct
––Q d
)
––d e
;
––e f
}
—— 
if
™™ 
(
™™ 
productFilter
™™ 
.
™™ 
	CreatedAt
™™ '
.
™™' (
Year
™™( ,
>
™™- .
$num
™™/ 0
)
™™0 1
{
šš 
if
›› 
(
›› 
filter
›› 
==
›› 
null
›› "
)
››" #
{
œœ 
filter
 
=
 
PredicateBuilder
 -
.
- .
New
. 1
<
1 2
Product
2 9
>
9 :
(
: ;
true
; ?
)
? @
;
@ A
}
 
filter
   
=
   
filter
   
.
    
And
    #
(
  # $
x
  $ %
=>
  & (
x
  ) *
.
  * +
Id
  + -
==
  . 0
productFilter
  1 >
.
  > ?
Id
  ? A
)
  A B
;
  B C
}
¡¡ 
if
££ 
(
££ 
!
££ 
string
££ 
.
££  
IsNullOrWhiteSpace
££ *
(
££* +
productFilter
££+ 8
.
££8 9
Order
££9 >
)
££> ?
)
££? @
{
¤¤ 
switch
¥¥ 
(
¥¥ 
productFilter
¥¥ %
.
¥¥% &
Order
¥¥& +
)
¥¥+ ,
{
¦¦ 
case
§§ 
$str
§§ 
:
§§ 
ordeBy
¨¨ 
=
¨¨  
x
¨¨! "
=>
¨¨# %
x
¨¨& '
.
¨¨' (
OrderBy
¨¨( /
(
¨¨/ 0
n
¨¨0 1
=>
¨¨2 4
n
¨¨5 6
.
¨¨6 7
Id
¨¨7 9
)
¨¨9 :
;
¨¨: ;
break
©© 
;
©© 
case
ªª 
$str
ªª 
:
ªª  
ordeBy
«« 
=
««  
x
««! "
=>
««# %
x
««& '
.
««' (
OrderBy
««( /
(
««/ 0
n
««0 1
=>
««2 4
n
««5 6
.
««6 7
Name
««7 ;
)
««; <
;
««< =
break
¬¬ 
;
¬¬ 
case
­­ 
$str
­­ &
:
­­& '
ordeBy
®® 
=
®®  
x
®®! "
=>
®®# %
x
®®& '
.
®®' (
OrderBy
®®( /
(
®®/ 0
n
®®0 1
=>
®®2 4
n
®®5 6
.
®®6 7
Description
®®7 B
)
®®B C
;
®®C D
break
¯¯ 
;
¯¯ 
case
°° 
$str
°°  
:
°°  !
ordeBy
±± 
=
±±  
x
±±! "
=>
±±# %
x
±±& '
.
±±' (
OrderBy
±±( /
(
±±/ 0
n
±±0 1
=>
±±2 4
n
±±5 6
.
±±6 7
Price
±±7 <
)
±±< =
;
±±= >
break
²² 
;
²² 
case
³³ 
$str
³³ $
:
³³$ %
ordeBy
´´ 
=
´´  
x
´´! "
=>
´´# %
x
´´& '
.
´´' (
OrderBy
´´( /
(
´´/ 0
n
´´0 1
=>
´´2 4
n
´´5 6
.
´´6 7
	CreatedAt
´´7 @
)
´´@ A
;
´´A B
break
µµ 
;
µµ 
}
¶¶ 
}
·· 
return
¹¹ 
await
¹¹  
_productRepository
¹¹ +
.
ºº 
Search
ºº 
(
ºº 
filter
»» 
,
»» 
ordeBy
¼¼ 
,
¼¼ 
productFilter
½½ !
.
½½! "
PageSize
½½" *
,
½½* +
productFilter
¾¾ !
.
¾¾! "
	PageIndex
¾¾" +
)
¾¾+ ,
;
¾¾, -
}
¿¿ 	
public
ÁÁ 
async
ÁÁ 
Task
ÁÁ 
<
ÁÁ 
Product
ÁÁ !
>
ÁÁ! "
GetById
ÁÁ# *
(
ÁÁ* +
Guid
ÁÁ+ /
id
ÁÁ0 2
)
ÁÁ2 3
{
ÂÂ 	
return
ÃÃ 
await
ÃÃ  
_productRepository
ÃÃ +
.
ÄÄ 
GetById
ÄÄ 
(
ÄÄ 
id
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
public
ÇÇ 
async
ÇÇ 
Task
ÇÇ 
<
ÇÇ 
Product
ÇÇ !
>
ÇÇ! "
Update
ÇÇ# )
(
ÇÇ) *
Product
ÇÇ* 1
product
ÇÇ2 9
)
ÇÇ9 :
{
ÈÈ 	
if
ÉÉ 
(
ÉÉ 
!
ÉÉ 
Validate
ÉÉ 
(
ÉÉ 
new
ÉÉ 
ProductValidation
ÉÉ /
(
ÉÉ/ 0
)
ÉÉ0 1
,
ÉÉ1 2
product
ÉÉ3 :
)
ÉÉ: ;
)
ÉÉ; <
return
ÉÉ= C
null
ÉÉD H
;
ÉÉH I
var
ËË 
	productDB
ËË 
=
ËË 
await
ËË ! 
_productRepository
ËË" 4
.
ÌÌ 
GetById
ÌÌ 
(
ÌÌ 
product
ÌÌ  
.
ÌÌ  !
Id
ÌÌ! #
)
ÌÌ# $
;
ÌÌ$ %
if
ÎÎ 
(
ÎÎ 
	productDB
ÎÎ 
==
ÎÎ 
null
ÎÎ !
)
ÎÎ! "
{
ÏÏ 
NotifyError
ĞĞ 
(
ĞĞ 
$str
ĞĞ '
)
ĞĞ' (
;
ĞĞ( )
return
ÑÑ 
await
ÑÑ 
Task
ÑÑ !
.
ÑÑ! "

FromResult
ÑÑ" ,
<
ÑÑ, -
Product
ÑÑ- 4
>
ÑÑ4 5
(
ÑÑ5 6
null
ÑÑ6 :
)
ÑÑ: ;
;
ÑÑ; <
}
ÒÒ 
if
ÔÔ 
(
ÔÔ 
product
ÔÔ 
.
ÔÔ 
CategoryProduct
ÔÔ '
!=
ÔÔ( *
null
ÔÔ+ /
)
ÔÔ/ 0
{
ÕÕ 
var
ÖÖ 
categoryProduct
ÖÖ #
=
ÖÖ$ %
await
ÖÖ& +(
_categoryProductRepository
ÖÖ, F
.
×× 
GetById
×× 
(
×× 
product
×× $
.
××$ %
IdCategoryProduct
××% 6
)
××6 7
;
××7 8
if
ÙÙ 
(
ÙÙ 
categoryProduct
ÙÙ #
==
ÙÙ$ &
null
ÙÙ' +
)
ÙÙ+ ,
{
ÚÚ 
NotifyError
ÛÛ 
(
ÛÛ  
$str
ÛÛ  <
)
ÛÛ< =
;
ÛÛ= >
return
ÜÜ 
await
ÜÜ  
Task
ÜÜ! %
.
ÜÜ% &

FromResult
ÜÜ& 0
<
ÜÜ0 1
Product
ÜÜ1 8
>
ÜÜ8 9
(
ÜÜ9 :
null
ÜÜ: >
)
ÜÜ> ?
;
ÜÜ? @
}
İİ 
}
ßß 
if
áá 
(
áá 
	productDB
áá 
.
áá 
Name
áá 
!=
áá !
product
áá" )
.
áá) *
Name
áá* .
)
áá. /
{
ââ 
	productDB
ãã 
.
ãã 
Name
ãã 
=
ãã  
product
ãã! (
.
ãã( )
Name
ãã) -
;
ãã- .
}
ää 
if
ææ 
(
ææ 
	productDB
ææ 
.
ææ 
Description
ææ %
!=
ææ& (
product
ææ) 0
.
ææ0 1
Description
ææ1 <
)
ææ< =
{
çç 
	productDB
èè 
.
èè 
Description
èè %
=
èè& '
product
èè( /
.
èè/ 0
Description
èè0 ;
;
èè; <
}
éé 
if
ëë 
(
ëë 
	productDB
ëë 
.
ëë 
Price
ëë 
!=
ëë  "
product
ëë# *
.
ëë* +
Price
ëë+ 0
)
ëë0 1
{
ìì 
	productDB
íí 
.
íí 
Price
íí 
=
íí  !
product
íí" )
.
íí) *
Price
íí* /
;
íí/ 0
}
îî 
if
ğğ 
(
ğğ 
	productDB
ğğ 
.
ğğ 
Kosher
ğğ  
!=
ğğ! #
product
ğğ$ +
.
ğğ+ ,
Kosher
ğğ, 2
)
ğğ2 3
{
ññ 
	productDB
òò 
.
òò 
Kosher
òò  
=
òò! "
product
òò# *
.
òò* +
Kosher
òò+ 1
;
òò1 2
}
óó 
if
õõ 
(
õõ 
	productDB
õõ 
.
õõ 
Vegan
õõ 
!=
õõ  "
product
õõ# *
.
õõ* +
Vegan
õõ+ 0
)
õõ0 1
{
öö 
	productDB
÷÷ 
.
÷÷ 
Vegan
÷÷ 
=
÷÷  !
product
÷÷" )
.
÷÷) *
Vegan
÷÷* /
;
÷÷/ 0
}
øø 
if
úú 
(
úú 
	productDB
úú 
.
úú 

Vegetarian
úú $
!=
úú% '
product
úú( /
.
úú/ 0

Vegetarian
úú0 :
)
úú: ;
{
ûû 
	productDB
üü 
.
üü 

Vegetarian
üü $
=
üü% &
product
üü' .
.
üü. /

Vegetarian
üü/ 9
;
üü9 :
}
ıı 
if
ÿÿ 
(
ÿÿ 
	productDB
ÿÿ 
.
ÿÿ 
Image
ÿÿ 
!=
ÿÿ  "
product
ÿÿ# *
.
ÿÿ* +
Image
ÿÿ+ 0
)
ÿÿ0 1
{
€€ 
	productDB
 
.
 
Image
 
=
  !
product
" )
.
) *
Image
* /
;
/ 0
}
‚‚  
_productRepository
„„ 
.
…… 
Update
…… 
(
…… 
	productDB
…… !
)
……! "
;
……" #
if
‡‡ 
(
‡‡ 
await
‡‡  
_productRepository
‡‡ (
.
‡‡( )
Commit
‡‡) /
(
‡‡/ 0
)
‡‡0 1
)
‡‡1 2
{
ˆˆ 
return
‰‰ 
await
‰‰ 
Task
‰‰ !
.
‰‰! "

FromResult
‰‰" ,
(
‰‰, -
	productDB
‰‰- 6
)
‰‰6 7
;
‰‰7 8
}
ŠŠ 
NotifyError
ŒŒ 
(
ŒŒ 
$str
ŒŒ /
)
ŒŒ/ 0
;
ŒŒ0 1
return
 
await
 
Task
 
.
 

FromResult
 (
<
( )
Product
) 0
>
0 1
(
1 2
null
2 6
)
6 7
;
7 8
}
 	
public
 
async
 
Task
 
<
 
Product
 !
>
! "
Delete
# )
(
) *
Guid
* .
id
/ 1
)
1 2
{
‘‘ 	
var
’’ 
product
’’ 
=
’’ 
await
’’  
_productRepository
’’  2
.
““ 
GetById
““ 
(
““ 
id
““ 
)
““ 
;
““ 
if
•• 
(
•• 
product
•• 
==
•• 
null
•• 
)
••  
{
–– 
NotifyError
—— 
(
—— 
$str
—— '
)
——' (
;
——( )
return
˜˜ 
await
˜˜ 
Task
˜˜ !
.
˜˜! "

FromResult
˜˜" ,
<
˜˜, -
Product
˜˜- 4
>
˜˜4 5
(
˜˜5 6
null
˜˜6 :
)
˜˜: ;
;
˜˜; <
}
™™  
_productRepository
›› 
.
œœ 
Remove
œœ 
(
œœ 
id
œœ 
)
œœ 
;
œœ 
if
 
(
 
await
  
_productRepository
 (
.
( )
Commit
) /
(
/ 0
)
0 1
)
1 2
{
ŸŸ 
return
   
await
   
Task
   !
.
  ! "

FromResult
  " ,
(
  , -
product
  - 4
)
  4 5
;
  5 6
}
¡¡ 
NotifyError
££ 
(
££ 
$str
££ /
)
££/ 0
;
££0 1
return
¤¤ 
await
¤¤ 
Task
¤¤ 
.
¤¤ 

FromResult
¤¤ (
<
¤¤( )
Product
¤¤) 0
>
¤¤0 1
(
¤¤1 2
null
¤¤2 6
)
¤¤6 7
;
¤¤7 8
}
¥¥ 	
public
§§ 
async
§§ 
Task
§§ 
<
§§ 
List
§§ 
<
§§ 
Product
§§ &
>
§§& '
>
§§' (
GetByRestaurant
§§) 8
(
§§8 9
Guid
§§9 =
id
§§> @
)
§§@ A
{
¨¨ 	
var
©© 

restaurant
©© 
=
©© 
await
©© "#
_restaurantRepository
©©# 8
.
ªª 
GetById
ªª 
(
ªª 
id
ªª 
)
ªª 
;
ªª 
if
¬¬ 
(
¬¬ 

restaurant
¬¬ 
==
¬¬ 
null
¬¬ !
)
¬¬! "
{
­­ 
NotifyError
®® 
(
®® 
$str
®® 3
)
®®3 4
;
®®4 5
return
¯¯ 
await
¯¯ 
Task
¯¯ !
.
¯¯! "

FromResult
¯¯" ,
<
¯¯, -
List
¯¯- 1
<
¯¯1 2
Product
¯¯2 9
>
¯¯9 :
>
¯¯: ;
(
¯¯; <
null
¯¯< @
)
¯¯@ A
;
¯¯A B
}
°° 
return
²² 
await
²²  
_productRepository
²² +
.
³³ 
GetByRestaurant
³³ !
(
³³! "
id
³³" $
)
³³$ %
;
³³% &
}
´´ 	
public
¶¶ 
async
¶¶ 
Task
¶¶ 
<
¶¶ 
Product
¶¶ !
>
¶¶! "(
GetByRestaurantByIdProduct
¶¶# =
(
¶¶= >
Guid
¶¶> B
idRestaurant
¶¶C O
,
¶¶O P
Guid
¶¶Q U
	idProduct
¶¶V _
)
¶¶_ `
{
·· 	
var
¸¸ 

restaurant
¸¸ 
=
¸¸ 
await
¸¸ "#
_restaurantRepository
¸¸# 8
.
¹¹ 
GetById
¹¹ 
(
¹¹ 
idRestaurant
¹¹ %
)
¹¹% &
;
¹¹& '
if
»» 
(
»» 

restaurant
»» 
==
»» 
null
»» "
)
»»" #
{
¼¼ 
NotifyError
½½ 
(
½½ 
$str
½½ 3
)
½½3 4
;
½½4 5
return
¾¾ 
await
¾¾ 
Task
¾¾ !
.
¾¾! "

FromResult
¾¾" ,
<
¾¾, -
Product
¾¾- 4
>
¾¾4 5
(
¾¾5 6
null
¾¾6 :
)
¾¾: ;
;
¾¾; <
}
¿¿ 
return
ÁÁ 
await
ÁÁ  
_productRepository
ÁÁ +
.
ÂÂ (
GetByRestaurantByIdProduct
ÂÂ ,
(
ÂÂ, -
idRestaurant
ÂÂ- 9
,
ÂÂ9 :
	idProduct
ÂÂ; D
)
ÂÂD E
;
ÂÂE F
}
ÃÃ 	
}
ÄÄ 
}ÅÅ ´À
QD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\RestaurantService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class 
RestaurantService "
:# $
BaseService% 0
,0 1
IRestaurantService2 D
{ 
private 
readonly !
IRestaurantRepository .!
_restaurantRepository/ D
;D E
private 
readonly )
ICategoryRestaurantRepository 6)
_categoryRestaurantRepository7 T
;T U
public 
RestaurantService  
(  !!
IRestaurantRepository ! 
restaurantRepository" 6
,6 7)
ICategoryRestaurantRepository )(
categoryRestaurantRepository* F
,F G
	INotifier 
notifier 
) 
:  !
base" &
(& '
notifier' /
)/ 0
{ 	!
_restaurantRepository !
=" # 
restaurantRepository$ 8
;8 9)
_categoryRestaurantRepository )
=* +(
categoryRestaurantRepository, H
;H I
} 	
public   
async   
Task   
<   

Restaurant   $
>  $ %
Create  & ,
(  , -

Restaurant  - 7

restaurant  8 B
)  B C
{!! 	
if"" 
("" 
!"" 
Validate"" 
("" 
new""  
RestaurantValidation"" 2
(""2 3
)""3 4
,""4 5

restaurant""6 @
)""@ A
)""A B
return""C I
null""J N
;""N O
if## 
(## 
!## 
Validate## 
(## 
new## '
AddressRestaurantValidation## 9
(##9 :
)##: ;
,##; <

restaurant##= G
.##G H
AddressRestaurant##H Y
)##Y Z
)##Z [
return##\ b
null##c g
;##g h
var%% 
restaurantBD%% 
=%% 
await%% $!
_restaurantRepository%%% :
.&& 
Search&& 
(&& 
x&& 
=>&& 
x&& 
.&& 
Name&& #
==&&$ &

restaurant&&' 1
.&&1 2
Name&&2 6
)&&6 7
;&&7 8
if(( 
((( 
restaurantBD(( 
!=(( 
null((  $
&&((% '
restaurantBD((( 4
.((4 5
Any((5 8
(((8 9
)((9 :
)((: ;
{)) 
NotifyError** 
(** 
$str** E
)**E F
;**F G
return++ 
await++ 
Task++ !
.++! "

FromResult++" ,
<++, -

Restaurant++- 7
>++7 8
(++8 9
null++9 =
)++= >
;++> ?
},, 
var.. 
categoryRestaurant.. "
=..# $
await..% *)
_categoryRestaurantRepository..+ H
.// 
GetById// 
(// 

restaurant// #
.//# $ 
IdCategoryRestaurant//$ 8
)//8 9
;//9 :
if11 
(11 
categoryRestaurant11 "
==11# %
null11& *
)11* +
{22 
NotifyError33 
(33 
$str33 ;
)33; <
;33< =
return44 
await44 
Task44 !
.44! "

FromResult44" ,
<44, -

Restaurant44- 7
>447 8
(448 9
null449 =
)44= >
;44> ?
}55 
await77 !
_restaurantRepository77 '
.88 
Add88 
(88 

restaurant88 
)88  
;88  !
if:: 
(:: 
await:: !
_restaurantRepository:: +
.::+ ,
Commit::, 2
(::2 3
)::3 4
)::4 5
{;; 
return<< 
await<< 
Task<< !
.<<! "

FromResult<<" ,
(<<, -

restaurant<<- 7
)<<7 8
;<<8 9
}== 
NotifyError?? 
(?? 
$str?? 0
)??0 1
;??1 2
return@@ 
await@@ 
Task@@ 
.@@ 

FromResult@@ (
<@@( )

Restaurant@@) 3
>@@3 4
(@@4 5
null@@5 9
)@@9 :
;@@: ;
}AA 	
publicCC 
asyncCC 
TaskCC 
<CC 
ListCC 
<CC 

RestaurantCC )
>CC) *
>CC* +
GetAllWithFilterCC, <
(CC< =
RestaurantFilterCC= M
restaurantFilterCCN ^
)CC^ _
{DD 	

ExpressionEE 
<EE 
FuncEE 
<EE 

RestaurantEE &
,EE& '
boolEE( ,
>EE, -
>EE- .
filterEE/ 5
=EE6 7
nullEE8 <
;EE< =
FuncFF 
<FF 

IQueryableFF 
<FF 

RestaurantFF &
>FF& '
,FF' (
IOrderedQueryableFF) :
<FF: ;

RestaurantFF; E
>FFE F
>FFF G
ordeByFFH N
=FFO P
nullFFQ U
;FFU V
ifHH 
(HH 
!HH 
stringHH 
.HH 
IsNullOrWhiteSpaceHH *
(HH* +
restaurantFilterHH+ ;
.HH; <
NameHH< @
)HH@ A
)HHA B
{II 
ifJJ 
(JJ 
filterJJ 
==JJ 
nullJJ "
)JJ" #
{KK 
filterLL 
=LL 
PredicateBuilderLL -
.LL- .
NewLL. 1
<LL1 2

RestaurantLL2 <
>LL< =
(LL= >
trueLL> B
)LLB C
;LLC D
}MM 
filterOO 
=OO 
filterOO 
.OO  
AndOO  #
(OO# $
xOO$ %
=>OO& (
xOO) *
.OO* +
NameOO+ /
==OO0 2
restaurantFilterOO3 C
.OOC D
NameOOD H
)OOH I
;OOI J
}PP 
ifRR 
(RR 
!RR 
stringRR 
.RR 
IsNullOrWhiteSpaceRR *
(RR* +
restaurantFilterRR+ ;
.RR; <
DescriptionRR< G
)RRG H
)RRH I
{SS 
ifTT 
(TT 
filterTT 
==TT 
nullTT "
)TT" #
{UU 
filterVV 
=VV 
PredicateBuilderVV -
.VV- .
NewVV. 1
<VV1 2

RestaurantVV2 <
>VV< =
(VV= >
trueVV> B
)VVB C
;VVC D
}WW 
filterYY 
=YY 
filterYY 
.YY  
AndYY  #
(YY# $
xYY$ %
=>YY& (
xYY) *
.YY* +
DescriptionYY+ 6
==YY7 9
restaurantFilterYY: J
.YYJ K
DescriptionYYK V
)YYV W
;YYW X
}ZZ 
if\\ 
(\\ 
!\\ 
string\\ 
.\\ 
IsNullOrWhiteSpace\\ *
(\\* +
restaurantFilter\\+ ;
.\\; <
CategoryName\\< H
)\\H I
)\\I J
{]] 
if^^ 
(^^ 
filter^^ 
==^^ 
null^^ "
)^^" #
{__ 
filter`` 
=`` 
PredicateBuilder`` -
.``- .
New``. 1
<``1 2

Restaurant``2 <
>``< =
(``= >
true``> B
)``B C
;``C D
}aa 
filtercc 
=cc 
filtercc 
.cc  
Andcc  #
(cc# $
xcc$ %
=>cc& (
xcc) *
.cc* +
CategoryRestaurantcc+ =
.cc= >
Namecc> B
==ccC E
restaurantFilterccF V
.ccV W
CategoryNameccW c
)ccc d
;ccd e
}dd 
ifff 
(ff 
!ff 
stringff 
.ff 
IsNullOrWhiteSpaceff *
(ff* +
restaurantFilterff+ ;
.ff; <
Orderff< A
)ffA B
)ffB C
{gg 
switchhh 
(hh 
restaurantFilterhh (
.hh( )
Orderhh) .
)hh. /
{ii 
casejj 
$strjj 
:jj 
ordeBykk 
=kk  
xkk! "
=>kk# %
xkk& '
.kk' (
OrderBykk( /
(kk/ 0
nkk0 1
=>kk2 4
nkk5 6
.kk6 7
Idkk7 9
)kk9 :
;kk: ;
breakll 
;ll 
casemm 
$strmm 
:mm  
ordeBynn 
=nn  
xnn! "
=>nn# %
xnn& '
.nn' (
OrderBynn( /
(nn/ 0
nnn0 1
=>nn2 4
nnn5 6
.nn6 7
Namenn7 ;
)nn; <
;nn< =
breakoo 
;oo 
casepp 
$strpp &
:pp& '
ordeByqq 
=qq  
xqq! "
=>qq# %
xqq& '
.qq' (
OrderByqq( /
(qq/ 0
nqq0 1
=>qq2 4
nqq5 6
.qq6 7
Descriptionqq7 B
)qqB C
;qqC D
breakrr 
;rr 
casess 
$strss $
:ss$ %
ordeBytt 
=tt  
xtt! "
=>tt# %
xtt& '
.tt' (
OrderBytt( /
(tt/ 0
ntt0 1
=>tt2 4
ntt5 6
.tt6 7
	CreatedAttt7 @
)tt@ A
;ttA B
breakuu 
;uu 
}vv 
}ww 
ifyy 
(yy 
restaurantFilteryy  
.yy  !
Idyy! #
!=yy$ &
Guidyy' +
.yy+ ,
Emptyyy, 1
)yy1 2
{zz 
if{{ 
({{ 
filter{{ 
=={{ 
null{{ "
){{" #
{|| 
filter}} 
=}} 
PredicateBuilder}} -
.}}- .
New}}. 1
<}}1 2

Restaurant}}2 <
>}}< =
(}}= >
true}}> B
)}}B C
;}}C D
}~~ 
filter
€€ 
=
€€ 
filter
€€ 
.
€€  
And
€€  #
(
€€# $
x
€€$ %
=>
€€& (
x
€€) *
.
€€* +
Id
€€+ -
==
€€. 0
restaurantFilter
€€1 A
.
€€A B
Id
€€B D
)
€€D E
;
€€E F
}
 
if
ƒƒ 
(
ƒƒ 
restaurantFilter
ƒƒ  
.
ƒƒ  !

CategoryId
ƒƒ! +
!=
ƒƒ, .
Guid
ƒƒ/ 3
.
ƒƒ3 4
Empty
ƒƒ4 9
)
ƒƒ9 :
{
„„ 
if
…… 
(
…… 
filter
…… 
==
…… 
null
…… "
)
……" #
{
†† 
filter
‡‡ 
=
‡‡ 
PredicateBuilder
‡‡ -
.
‡‡- .
New
‡‡. 1
<
‡‡1 2

Restaurant
‡‡2 <
>
‡‡< =
(
‡‡= >
true
‡‡> B
)
‡‡B C
;
‡‡C D
}
ˆˆ 
filter
ŠŠ 
=
ŠŠ 
filter
ŠŠ 
.
ŠŠ  
And
ŠŠ  #
(
ŠŠ# $
x
ŠŠ$ %
=>
ŠŠ& (
x
ŠŠ) *
.
ŠŠ* + 
CategoryRestaurant
ŠŠ+ =
.
ŠŠ= >
Id
ŠŠ> @
==
ŠŠA C
restaurantFilter
ŠŠD T
.
ŠŠT U

CategoryId
ŠŠU _
)
ŠŠ_ `
;
ŠŠ` a
}
‹‹ 
if
 
(
 
restaurantFilter
  
.
  !
	CreatedAt
! *
.
* +
Year
+ /
>
0 1
$num
2 3
)
3 4
{
 
if
 
(
 
filter
 
==
 
null
 "
)
" #
{
 
filter
‘‘ 
=
‘‘ 
PredicateBuilder
‘‘ -
.
‘‘- .
New
‘‘. 1
<
‘‘1 2

Restaurant
‘‘2 <
>
‘‘< =
(
‘‘= >
true
‘‘> B
)
‘‘B C
;
‘‘C D
}
’’ 
filter
”” 
=
”” 
filter
”” 
.
””  
And
””  #
(
””# $
x
””$ %
=>
””& (
x
””) *
.
””* +
Id
””+ -
==
””. 0
restaurantFilter
””1 A
.
””A B
Id
””B D
)
””D E
;
””E F
}
•• 
return
—— 
await
—— #
_restaurantRepository
—— .
.
˜˜ 
Search
˜˜ 
(
˜˜ 
filter
™™ 
,
™™ 
ordeBy
šš 
,
šš 
restaurantFilter
›› $
.
››$ %
PageSize
››% -
,
››- .
restaurantFilter
œœ $
.
œœ$ %
	PageIndex
œœ% .
)
œœ. /
;
œœ/ 0
}
 	
public
ŸŸ 
async
ŸŸ 
Task
ŸŸ 
<
ŸŸ 

Restaurant
ŸŸ $
>
ŸŸ$ %
GetById
ŸŸ& -
(
ŸŸ- .
Guid
ŸŸ. 2
id
ŸŸ3 5
)
ŸŸ5 6
{
   	
return
¡¡ 
await
¡¡ #
_restaurantRepository
¡¡ .
.
¢¢ 
GetById
¢¢ 
(
¢¢ 
id
¢¢ 
)
¢¢ 
;
¢¢ 
}
££ 	
public
¥¥ 
async
¥¥ 
Task
¥¥ 
<
¥¥ 

Restaurant
¥¥ $
>
¥¥$ %
Update
¥¥& ,
(
¥¥, -

Restaurant
¥¥- 7

restaurant
¥¥8 B
)
¥¥B C
{
¦¦ 	
if
§§ 
(
§§ 
!
§§ 
Validate
§§ 
(
§§ 
new
§§ "
RestaurantValidation
§§ 2
(
§§2 3
)
§§3 4
,
§§4 5

restaurant
§§6 @
)
§§@ A
)
§§A B
return
§§C I
null
§§J N
;
§§N O
var
©© 
restaurantDB
©© 
=
©© 
await
©© $#
_restaurantRepository
©©% :
.
ªª 
GetById
ªª 
(
ªª 

restaurant
ªª #
.
ªª# $
Id
ªª$ &
)
ªª& '
;
ªª' (
if
¬¬ 
(
¬¬ 
restaurantDB
¬¬ 
==
¬¬ 
null
¬¬  $
)
¬¬$ %
{
­­ 
NotifyError
®® 
(
®® 
$str
®® '
)
®®' (
;
®®( )
return
¯¯ 
await
¯¯ 
Task
¯¯ !
.
¯¯! "

FromResult
¯¯" ,
<
¯¯, -

Restaurant
¯¯- 7
>
¯¯7 8
(
¯¯8 9
null
¯¯9 =
)
¯¯= >
;
¯¯> ?
}
°° 
if
²² 
(
²² 

restaurant
²² 
.
²²  
CategoryRestaurant
²² -
!=
²². 0
null
²²1 5
)
²²5 6
{
³³ 
if
´´ 
(
´´ 
!
´´ 
Validate
´´ 
(
´´ 
new
´´ !)
AddressRestaurantValidation
´´" =
(
´´= >
)
´´> ?
,
´´? @

restaurant
´´A K
.
´´K L
AddressRestaurant
´´L ]
)
´´] ^
)
´´^ _
return
´´` f
null
´´g k
;
´´k l
var
¶¶  
categoryRestaurant
¶¶ &
=
¶¶' (
await
¶¶) .+
_categoryRestaurantRepository
¶¶/ L
.
·· 
GetById
·· 
(
·· 

restaurant
·· '
.
··' ("
IdCategoryRestaurant
··( <
)
··< =
;
··= >
if
¹¹ 
(
¹¹  
categoryRestaurant
¹¹ &
==
¹¹' )
null
¹¹* .
)
¹¹. /
{
ºº 
NotifyError
»» 
(
»»  
$str
»»  ?
)
»»? @
;
»»@ A
return
¼¼ 
await
¼¼  
Task
¼¼! %
.
¼¼% &

FromResult
¼¼& 0
<
¼¼0 1

Restaurant
¼¼1 ;
>
¼¼; <
(
¼¼< =
null
¼¼= A
)
¼¼A B
;
¼¼B C
}
½½ 
}
¿¿ 
if
ÁÁ 
(
ÁÁ 

restaurant
ÁÁ 
.
ÁÁ 
AddressRestaurant
ÁÁ ,
!=
ÁÁ- /
null
ÁÁ0 4
)
ÁÁ4 5
{
ÂÂ 
if
ÃÃ 
(
ÃÃ 
restaurantDB
ÃÃ  
.
ÃÃ  !
AddressRestaurant
ÃÃ! 2
.
ÃÃ2 3
Street
ÃÃ3 9
!=
ÃÃ: <

restaurant
ÃÃ= G
.
ÃÃG H
AddressRestaurant
ÃÃH Y
.
ÃÃY Z
Street
ÃÃZ `
)
ÃÃ` a
{
ÄÄ 
restaurantDB
ÅÅ  
.
ÅÅ  !
AddressRestaurant
ÅÅ! 2
.
ÅÅ2 3
Street
ÅÅ3 9
=
ÅÅ: ;

restaurant
ÅÅ< F
.
ÅÅF G
AddressRestaurant
ÅÅG X
.
ÅÅX Y
Street
ÅÅY _
;
ÅÅ_ `
}
ÆÆ 
if
ÈÈ 
(
ÈÈ 
restaurantDB
ÈÈ  
.
ÈÈ  !
AddressRestaurant
ÈÈ! 2
.
ÈÈ2 3
District
ÈÈ3 ;
!=
ÈÈ< >

restaurant
ÈÈ? I
.
ÈÈI J
AddressRestaurant
ÈÈJ [
.
ÈÈ[ \
District
ÈÈ\ d
)
ÈÈd e
{
ÉÉ 
restaurantDB
ÊÊ  
.
ÊÊ  !
AddressRestaurant
ÊÊ! 2
.
ÊÊ2 3
District
ÊÊ3 ;
=
ÊÊ< =

restaurant
ÊÊ> H
.
ÊÊH I
AddressRestaurant
ÊÊI Z
.
ÊÊZ [
District
ÊÊ[ c
;
ÊÊc d
}
ËË 
if
ÍÍ 
(
ÍÍ 
restaurantDB
ÍÍ  
.
ÍÍ  !
AddressRestaurant
ÍÍ! 2
.
ÍÍ2 3
City
ÍÍ3 7
!=
ÍÍ8 :

restaurant
ÍÍ; E
.
ÍÍE F
AddressRestaurant
ÍÍF W
.
ÍÍW X
City
ÍÍX \
)
ÍÍ\ ]
{
ÎÎ 
restaurantDB
ÏÏ  
.
ÏÏ  !
AddressRestaurant
ÏÏ! 2
.
ÏÏ2 3
City
ÏÏ3 7
=
ÏÏ8 9

restaurant
ÏÏ: D
.
ÏÏD E
AddressRestaurant
ÏÏE V
.
ÏÏV W
City
ÏÏW [
;
ÏÏ[ \
}
ĞĞ 
if
ÒÒ 
(
ÒÒ 
restaurantDB
ÒÒ  
.
ÒÒ  !
AddressRestaurant
ÒÒ! 2
.
ÒÒ2 3
County
ÒÒ3 9
!=
ÒÒ: <

restaurant
ÒÒ= G
.
ÒÒG H
AddressRestaurant
ÒÒH Y
.
ÒÒY Z
County
ÒÒZ `
)
ÒÒ` a
{
ÓÓ 
restaurantDB
ÔÔ  
.
ÔÔ  !
AddressRestaurant
ÔÔ! 2
.
ÔÔ2 3
County
ÔÔ3 9
=
ÔÔ: ;

restaurant
ÔÔ< F
.
ÔÔF G
AddressRestaurant
ÔÔG X
.
ÔÔX Y
County
ÔÔY _
;
ÔÔ_ `
}
ÕÕ 
if
×× 
(
×× 
restaurantDB
××  
.
××  !
AddressRestaurant
××! 2
.
××2 3
ZipCode
××3 :
!=
××; =

restaurant
××> H
.
××H I
AddressRestaurant
××I Z
.
××Z [
ZipCode
××[ b
)
××b c
{
ØØ 
restaurantDB
ÙÙ  
.
ÙÙ  !
AddressRestaurant
ÙÙ! 2
.
ÙÙ2 3
ZipCode
ÙÙ3 :
=
ÙÙ; <

restaurant
ÙÙ= G
.
ÙÙG H
AddressRestaurant
ÙÙH Y
.
ÙÙY Z
ZipCode
ÙÙZ a
;
ÙÙa b
}
ÚÚ 
if
ÜÜ 
(
ÜÜ 
restaurantDB
ÜÜ  
.
ÜÜ  !
AddressRestaurant
ÜÜ! 2
.
ÜÜ2 3
Latitude
ÜÜ3 ;
!=
ÜÜ< >

restaurant
ÜÜ? I
.
ÜÜI J
AddressRestaurant
ÜÜJ [
.
ÜÜ[ \
Latitude
ÜÜ\ d
)
ÜÜd e
{
İİ 
restaurantDB
ŞŞ  
.
ŞŞ  !
AddressRestaurant
ŞŞ! 2
.
ŞŞ2 3
Latitude
ŞŞ3 ;
=
ŞŞ< =

restaurant
ŞŞ> H
.
ŞŞH I
AddressRestaurant
ŞŞI Z
.
ŞŞZ [
Latitude
ŞŞ[ c
;
ŞŞc d
}
ßß 
if
áá 
(
áá 
restaurantDB
áá  
.
áá  !
AddressRestaurant
áá! 2
.
áá2 3
	Longitude
áá3 <
!=
áá= ?

restaurant
áá@ J
.
ááJ K
AddressRestaurant
ááK \
.
áá\ ]
	Longitude
áá] f
)
ááf g
{
ââ 
restaurantDB
ãã  
.
ãã  !
AddressRestaurant
ãã! 2
.
ãã2 3
	Longitude
ãã3 <
=
ãã= >

restaurant
ãã? I
.
ããI J
AddressRestaurant
ããJ [
.
ãã[ \
	Longitude
ãã\ e
;
ããe f
}
ää 
}
åå 
if
çç 
(
çç 
restaurantDB
çç 
.
çç 
Name
çç !
!=
çç" $

restaurant
çç% /
.
çç/ 0
Name
çç0 4
)
çç4 5
{
èè 
restaurantDB
éé 
.
éé 
Name
éé !
=
éé" #

restaurant
éé$ .
.
éé. /
Name
éé/ 3
;
éé3 4
}
êê 
if
ìì 
(
ìì 
restaurantDB
ìì 
.
ìì 
Description
ìì (
!=
ìì) +

restaurant
ìì, 6
.
ìì6 7
Description
ìì7 B
)
ììB C
{
íí 
restaurantDB
îî 
.
îî 
Description
îî (
=
îî) *

restaurant
îî+ 5
.
îî5 6
Description
îî6 A
;
îîA B
}
ïï 
if
ññ 
(
ññ 
restaurantDB
ññ 
.
ññ 
Image
ññ "
!=
ññ# %

restaurant
ññ& 0
.
ññ0 1
Image
ññ1 6
)
ññ6 7
{
òò 
restaurantDB
óó 
.
óó 
Image
óó "
=
óó# $

restaurant
óó% /
.
óó/ 0
Image
óó0 5
;
óó5 6
}
ôô #
_restaurantRepository
öö !
.
÷÷ 
Update
÷÷ 
(
÷÷ 
restaurantDB
÷÷ $
)
÷÷$ %
;
÷÷% &
if
ùù 
(
ùù 
await
ùù #
_restaurantRepository
ùù +
.
ùù+ ,
Commit
ùù, 2
(
ùù2 3
)
ùù3 4
)
ùù4 5
{
úú 
return
ûû 
await
ûû 
Task
ûû !
.
ûû! "

FromResult
ûû" ,
(
ûû, -
restaurantDB
ûû- 9
)
ûû9 :
;
ûû: ;
}
üü 
NotifyError
şş 
(
şş 
$str
şş /
)
şş/ 0
;
şş0 1
return
ÿÿ 
await
ÿÿ 
Task
ÿÿ 
.
ÿÿ 

FromResult
ÿÿ (
<
ÿÿ( )

Restaurant
ÿÿ) 3
>
ÿÿ3 4
(
ÿÿ4 5
null
ÿÿ5 9
)
ÿÿ9 :
;
ÿÿ: ;
}
€€ 	
public
‚‚ 
async
‚‚ 
Task
‚‚ 
<
‚‚ 

Restaurant
‚‚ $
>
‚‚$ %
Delete
‚‚& ,
(
‚‚, -
Guid
‚‚- 1
id
‚‚2 4
)
‚‚4 5
{
ƒƒ 	
var
„„ 

restaurant
„„ 
=
„„ 
await
„„ "#
_restaurantRepository
„„# 8
.
…… 
GetById
…… 
(
…… 
id
…… 
)
…… 
;
…… 
if
‡‡ 
(
‡‡ 

restaurant
‡‡ 
==
‡‡ 
null
‡‡ "
)
‡‡" #
{
ˆˆ 
NotifyError
‰‰ 
(
‰‰ 
$str
‰‰ '
)
‰‰' (
;
‰‰( )
return
ŠŠ 
await
ŠŠ 
Task
ŠŠ !
.
ŠŠ! "

FromResult
ŠŠ" ,
<
ŠŠ, -

Restaurant
ŠŠ- 7
>
ŠŠ7 8
(
ŠŠ8 9
null
ŠŠ9 =
)
ŠŠ= >
;
ŠŠ> ?
}
‹‹ #
_restaurantRepository
 !
.
 
Remove
 
(
 
id
 
)
 
;
 
if
 
(
 
await
 #
_restaurantRepository
 +
.
+ ,
Commit
, 2
(
2 3
)
3 4
)
4 5
{
‘‘ 
return
’’ 
await
’’ 
Task
’’ !
.
’’! "

FromResult
’’" ,
(
’’, -

restaurant
’’- 7
)
’’7 8
;
’’8 9
}
““ 
NotifyError
•• 
(
•• 
$str
•• /
)
••/ 0
;
••0 1
return
–– 
await
–– 
Task
–– 
.
–– 

FromResult
–– (
<
––( )

Restaurant
––) 3
>
––3 4
(
––4 5
null
––5 9
)
––9 :
;
––: ;
}
—— 	
}
˜˜ 
}™™ ¼
KD:\TI\git\v2\IHunger_API\IHunger\3 - Service\IHunger.Service\UserService.cs
	namespace 	
IHunger
 
. 
Service 
{ 
public 

class 
UserService 
: 
IUserService +
{		 
}

 
} 